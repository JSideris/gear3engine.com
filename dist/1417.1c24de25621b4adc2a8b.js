/*! For license information please see 1417.1c24de25621b4adc2a8b.js.LICENSE.txt */
"use strict";(self.webpackChunkgear3engine_website=self.webpackChunkgear3engine_website||[]).push([[1417],{1417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var s=r(932),a=r(2514),o=r(8950),i=r(2755),n=function(){function e(e,t,r){void 0===r&&(r=null),this._texture=e instanceof a.Texture?e:null,this.baseTexture=e instanceof a.BaseTexture?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;var s=this.baseTexture.resource;this.resolution=this._updateResolution(r||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return e.prototype._updateResolution=function(e){void 0===e&&(e=null);var t=this.data.meta.scale,r=o.getResolutionOfUrl(e,null);return null===r&&(r=void 0!==t?parseFloat(t):1),1!==r&&this.baseTexture.setResolution(r),r},e.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},e.prototype._processFrames=function(t){for(var r=t,o=e.BATCH_SIZE;r-t<o&&r<this._frameKeys.length;){var i=this._frameKeys[r],n=this._frames[i],u=n.frame;if(u){var l,h=null,c=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,f=new s.Rectangle(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);l=n.rotated?new s.Rectangle(Math.floor(u.x)/this.resolution,Math.floor(u.y)/this.resolution,Math.floor(u.h)/this.resolution,Math.floor(u.w)/this.resolution):new s.Rectangle(Math.floor(u.x)/this.resolution,Math.floor(u.y)/this.resolution,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(h=new s.Rectangle(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution)),this.textures[i]=new a.Texture(this.baseTexture,l,f,h,n.rotated?2:0,n.anchor),a.Texture.addToCache(this.textures[i],i)}r++}},e.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var s=e[t][r];this.animations[t].push(this.textures[s])}}},e.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},e.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout((function(){t._batchIndex*e.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())}),0)},e.prototype.destroy=function(e){var t;for(var r in void 0===e&&(e=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(null===(t=this._texture)||void 0===t||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},e.BATCH_SIZE=1e3,e}(),u=function(){function e(){}return e.use=function(t,r){var s,a,u=this,l=t.name+"_image";if(t.data&&t.type===i.LoaderResource.TYPE.JSON&&t.data.frames&&!u.resources[l]){var h=null===(a=null===(s=t.data)||void 0===s?void 0:s.meta)||void 0===a?void 0:a.related_multi_packs;if(Array.isArray(h))for(var c=function(e){if("string"!=typeof e)return"continue";var r=e.replace(".json",""),s=o.url.resolve(t.url.replace(u.baseUrl,""),e);if(u.resources[r]||Object.values(u.resources).some((function(e){return o.url.format(o.url.parse(e.url))===s})))return"continue";var a={crossOrigin:t.crossOrigin,loadType:i.LoaderResource.LOAD_TYPE.XHR,xhrType:i.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:t,metadata:t.metadata};u.add(r,s,a)},f=0,d=h;f<d.length;f++)c(d[f]);var p={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},_=e.getResourcePath(t,u.baseUrl);u.add(l,_,p,(function(e){if(e.error)r(e.error);else{var s=new n(e.texture,t.data,t.url);s.parse((function(){t.spritesheet=s,t.textures=s.textures,r()}))}}))}else r()},e.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:o.url.resolve(e.url.replace(t,""),e.data.meta.image)},e}();t.Spritesheet=n,t.SpritesheetLoader=u}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QzJELEdBQ0osR0FOQSxDQU9KLEdBakRBLE1BRklBLEdBb0RSLEVBTUFGLEVBQWtCMEMsZ0JBQWtCLFNBQVVqRyxFQUFVNkUsR0FFcEQsT0FBSTdFLEVBQVNxRyxVQUNGckcsRUFBU1QsS0FBS3FCLEtBQUswRixNQUV2Qm5ILEVBQU1nQixJQUFJeUUsUUFBUTVFLEVBQVNHLElBQUl1RSxRQUFRRyxFQUFTLElBQUs3RSxFQUFTVCxLQUFLcUIsS0FBSzBGLE1BQ25GLEVBQ08vQyxDQUNYLENBckZzQyxHQXVGdEN4RSxFQUFRTSxZQUFjQSxFQUN0Qk4sRUFBUXdFLGtCQUFvQkEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nZWFyM2VuZ2luZS13ZWJzaXRlLy4uLy4uL0dBTUVTLVNJTVVMQVRPUlMtRlVOL2dlYXIzZW5naW5lL3BsdWdpbnMvZzNlLWNhbnZhcy0yZC9ub2RlX21vZHVsZXMvQHBpeGkvc3ByaXRlc2hlZXQvZGlzdC9janMvc3ByaXRlc2hlZXQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAcGl4aS9zcHJpdGVzaGVldCAtIHY2LjQuMlxuICogQ29tcGlsZWQgVGh1LCAwMiBKdW4gMjAyMiAxNTozOToyNiBVVENcbiAqXG4gKiBAcGl4aS9zcHJpdGVzaGVldCBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4gKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcblxudmFyIG1hdGggPSByZXF1aXJlKCdAcGl4aS9tYXRoJyk7XG52YXIgY29yZSA9IHJlcXVpcmUoJ0BwaXhpL2NvcmUnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJ0BwaXhpL3V0aWxzJyk7XG52YXIgbG9hZGVycyA9IHJlcXVpcmUoJ0BwaXhpL2xvYWRlcnMnKTtcblxuLyoqXG4gKiBVdGlsaXR5IGNsYXNzIGZvciBtYWludGFpbmluZyByZWZlcmVuY2UgdG8gYSBjb2xsZWN0aW9uXG4gKiBvZiBUZXh0dXJlcyBvbiBhIHNpbmdsZSBTcHJpdGVzaGVldC5cbiAqXG4gKiBUbyBhY2Nlc3MgYSBzcHJpdGUgc2hlZXQgZnJvbSB5b3VyIGNvZGUgeW91IG1heSBwYXNzIGl0cyBKU09OIGRhdGEgZmlsZSB0byBQaXhpJ3MgbG9hZGVyOlxuICpcbiAqIGBgYGpzXG4gKiBQSVhJLkxvYWRlci5zaGFyZWQuYWRkKFwiaW1hZ2VzL3Nwcml0ZXNoZWV0Lmpzb25cIikubG9hZChzZXR1cCk7XG4gKlxuICogZnVuY3Rpb24gc2V0dXAoKSB7XG4gKiAgIGxldCBzaGVldCA9IFBJWEkuTG9hZGVyLnNoYXJlZC5yZXNvdXJjZXNbXCJpbWFnZXMvc3ByaXRlc2hlZXQuanNvblwiXS5zcHJpdGVzaGVldDtcbiAqICAgLi4uXG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBBbHRlcm5hdGVseSwgeW91IG1heSBjaXJjdW12ZW50IHRoZSBsb2FkZXIgYnkgaW5zdGFudGlhdGluZyB0aGUgU3ByaXRlc2hlZXQgZGlyZWN0bHk6XG4gKiBgYGBqc1xuICogY29uc3Qgc2hlZXQgPSBuZXcgUElYSS5TcHJpdGVzaGVldCh0ZXh0dXJlLCBzcHJpdGVzaGVldERhdGEpO1xuICogc2hlZXQucGFyc2UoKCkgPT4gY29uc29sZS5sb2coJ1Nwcml0ZXNoZWV0IHJlYWR5IHRvIHVzZSEnKSk7XG4gKiBgYGBcbiAqXG4gKiBXaXRoIHRoZSBgc2hlZXQudGV4dHVyZXNgIHlvdSBjYW4gY3JlYXRlIFNwcml0ZSBvYmplY3RzLGBzaGVldC5hbmltYXRpb25zYCBjYW4gYmUgdXNlZCB0byBjcmVhdGUgYW4gQW5pbWF0ZWRTcHJpdGUuXG4gKlxuICogU3ByaXRlIHNoZWV0cyBjYW4gYmUgcGFja2VkIHVzaW5nIHRvb2xzIGxpa2Uge0BsaW5rIGh0dHBzOi8vY29kZWFuZHdlYi5jb20vdGV4dHVyZXBhY2tlcnxUZXh0dXJlUGFja2VyfSxcbiAqIHtAbGluayBodHRwczovL3JlbmRlcmhqcy5uZXQvc2hvZWJveC98U2hvZWJveH0gb3Ige0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9rcnp5c3p0b2Ytby9zcHJpdGVzaGVldC5qc3xTcHJpdGVzaGVldC5qc30uXG4gKiBEZWZhdWx0IGFuY2hvciBwb2ludHMgKHNlZSB7QGxpbmsgUElYSS5UZXh0dXJlI2RlZmF1bHRBbmNob3J9KSBhbmQgZ3JvdXBpbmcgb2YgYW5pbWF0aW9uIHNwcml0ZXMgYXJlIGN1cnJlbnRseSBvbmx5XG4gKiBzdXBwb3J0ZWQgYnkgVGV4dHVyZVBhY2tlci5cbiAqIEBtZW1iZXJvZiBQSVhJXG4gKi9cbnZhciBTcHJpdGVzaGVldCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdGV4dHVyZSAtIFJlZmVyZW5jZSB0byB0aGUgc291cmNlIEJhc2VUZXh0dXJlIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIFNwcml0ZXNoZWV0IGltYWdlIGRhdGEuXG4gICAgICogQHBhcmFtIHJlc29sdXRpb25GaWxlbmFtZSAtIFRoZSBmaWxlbmFtZSB0byBjb25zaWRlciB3aGVuIGRldGVybWluaW5nXG4gICAgICogICAgICAgIHRoZSByZXNvbHV0aW9uIG9mIHRoZSBzcHJpdGVzaGVldC4gSWYgbm90IHByb3ZpZGVkLCB0aGUgaW1hZ2VVcmwgd2lsbFxuICAgICAqICAgICAgICBiZSB1c2VkIG9uIHRoZSBCYXNlVGV4dHVyZS5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBTcHJpdGVzaGVldCh0ZXh0dXJlLCBkYXRhLCByZXNvbHV0aW9uRmlsZW5hbWUpIHtcbiAgICAgICAgaWYgKHJlc29sdXRpb25GaWxlbmFtZSA9PT0gdm9pZCAwKSB7IHJlc29sdXRpb25GaWxlbmFtZSA9IG51bGw7IH1cbiAgICAgICAgdGhpcy5fdGV4dHVyZSA9IHRleHR1cmUgaW5zdGFuY2VvZiBjb3JlLlRleHR1cmUgPyB0ZXh0dXJlIDogbnVsbDtcbiAgICAgICAgdGhpcy5iYXNlVGV4dHVyZSA9IHRleHR1cmUgaW5zdGFuY2VvZiBjb3JlLkJhc2VUZXh0dXJlID8gdGV4dHVyZSA6IHRoaXMuX3RleHR1cmUuYmFzZVRleHR1cmU7XG4gICAgICAgIHRoaXMudGV4dHVyZXMgPSB7fTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25zID0ge307XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgICAgIHZhciByZXNvdXJjZSA9IHRoaXMuYmFzZVRleHR1cmUucmVzb3VyY2U7XG4gICAgICAgIHRoaXMucmVzb2x1dGlvbiA9IHRoaXMuX3VwZGF0ZVJlc29sdXRpb24ocmVzb2x1dGlvbkZpbGVuYW1lIHx8IChyZXNvdXJjZSA/IHJlc291cmNlLnVybCA6IG51bGwpKTtcbiAgICAgICAgdGhpcy5fZnJhbWVzID0gdGhpcy5kYXRhLmZyYW1lcztcbiAgICAgICAgdGhpcy5fZnJhbWVLZXlzID0gT2JqZWN0LmtleXModGhpcy5fZnJhbWVzKTtcbiAgICAgICAgdGhpcy5fYmF0Y2hJbmRleCA9IDA7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrID0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgdGhlIHJlc29sdXRpb24gZnJvbSB0aGUgZmlsZW5hbWUgb3IgZmFsbGJhY2tcbiAgICAgKiB0byB0aGUgbWV0YS5zY2FsZSBmaWVsZCBvZiB0aGUgSlNPTiBkYXRhLlxuICAgICAqIEBwYXJhbSByZXNvbHV0aW9uRmlsZW5hbWUgLSBUaGUgZmlsZW5hbWUgdG8gdXNlIGZvciByZXNvbHZpbmdcbiAgICAgKiAgICAgICAgdGhlIGRlZmF1bHQgcmVzb2x1dGlvbi5cbiAgICAgKiBAcmV0dXJucyBSZXNvbHV0aW9uIHRvIHVzZSBmb3Igc3ByaXRlc2hlZXQuXG4gICAgICovXG4gICAgU3ByaXRlc2hlZXQucHJvdG90eXBlLl91cGRhdGVSZXNvbHV0aW9uID0gZnVuY3Rpb24gKHJlc29sdXRpb25GaWxlbmFtZSkge1xuICAgICAgICBpZiAocmVzb2x1dGlvbkZpbGVuYW1lID09PSB2b2lkIDApIHsgcmVzb2x1dGlvbkZpbGVuYW1lID0gbnVsbDsgfVxuICAgICAgICB2YXIgc2NhbGUgPSB0aGlzLmRhdGEubWV0YS5zY2FsZTtcbiAgICAgICAgLy8gVXNlIGEgZGVmYXVsdFZhbHVlIG9mIGBudWxsYCB0byBjaGVjayBpZiBhIHVybC1iYXNlZCByZXNvbHV0aW9uIGlzIHNldFxuICAgICAgICB2YXIgcmVzb2x1dGlvbiA9IHV0aWxzLmdldFJlc29sdXRpb25PZlVybChyZXNvbHV0aW9uRmlsZW5hbWUsIG51bGwpO1xuICAgICAgICAvLyBObyByZXNvbHV0aW9uIGZvdW5kIHZpYSBVUkxcbiAgICAgICAgaWYgKHJlc29sdXRpb24gPT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIFVzZSB0aGUgc2NhbGUgdmFsdWUgb3IgZGVmYXVsdCB0byAxXG4gICAgICAgICAgICByZXNvbHV0aW9uID0gc2NhbGUgIT09IHVuZGVmaW5lZCA/IHBhcnNlRmxvYXQoc2NhbGUpIDogMTtcbiAgICAgICAgfVxuICAgICAgICAvLyBGb3Igbm9uLTEgcmVzb2x1dGlvbnMsIHVwZGF0ZSBiYXNlVGV4dHVyZVxuICAgICAgICBpZiAocmVzb2x1dGlvbiAhPT0gMSkge1xuICAgICAgICAgICAgdGhpcy5iYXNlVGV4dHVyZS5zZXRSZXNvbHV0aW9uKHJlc29sdXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNvbHV0aW9uO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUGFyc2VyIHNwcml0ZXNoZWV0IGZyb20gbG9hZGVkIGRhdGEuIFRoaXMgaXMgZG9uZSBhc3luY2hyb25vdXNseVxuICAgICAqIHRvIHByZXZlbnQgY3JlYXRpbmcgdG9vIG1hbnkgVGV4dHVyZSB3aXRoaW4gYSBzaW5nbGUgcHJvY2Vzcy5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIHdoZW4gY29tcGxldGUgcmV0dXJuc1xuICAgICAqICAgICAgICBhIG1hcCBvZiB0aGUgVGV4dHVyZXMgZm9yIHRoaXMgc3ByaXRlc2hlZXQuXG4gICAgICovXG4gICAgU3ByaXRlc2hlZXQucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2JhdGNoSW5kZXggPSAwO1xuICAgICAgICB0aGlzLl9jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICBpZiAodGhpcy5fZnJhbWVLZXlzLmxlbmd0aCA8PSBTcHJpdGVzaGVldC5CQVRDSF9TSVpFKSB7XG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzRnJhbWVzKDApO1xuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc0FuaW1hdGlvbnMoKTtcbiAgICAgICAgICAgIHRoaXMuX3BhcnNlQ29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX25leHRCYXRjaCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBQcm9jZXNzIGEgYmF0Y2ggb2YgZnJhbWVzXG4gICAgICogQHBhcmFtIGluaXRpYWxGcmFtZUluZGV4IC0gVGhlIGluZGV4IG9mIGZyYW1lIHRvIHN0YXJ0LlxuICAgICAqL1xuICAgIFNwcml0ZXNoZWV0LnByb3RvdHlwZS5fcHJvY2Vzc0ZyYW1lcyA9IGZ1bmN0aW9uIChpbml0aWFsRnJhbWVJbmRleCkge1xuICAgICAgICB2YXIgZnJhbWVJbmRleCA9IGluaXRpYWxGcmFtZUluZGV4O1xuICAgICAgICB2YXIgbWF4RnJhbWVzID0gU3ByaXRlc2hlZXQuQkFUQ0hfU0laRTtcbiAgICAgICAgd2hpbGUgKGZyYW1lSW5kZXggLSBpbml0aWFsRnJhbWVJbmRleCA8IG1heEZyYW1lcyAmJiBmcmFtZUluZGV4IDwgdGhpcy5fZnJhbWVLZXlzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9mcmFtZUtleXNbZnJhbWVJbmRleF07XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2ZyYW1lc1tpXTtcbiAgICAgICAgICAgIHZhciByZWN0ID0gZGF0YS5mcmFtZTtcbiAgICAgICAgICAgIGlmIChyZWN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIgdHJpbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZVNpemUgPSBkYXRhLnRyaW1tZWQgIT09IGZhbHNlICYmIGRhdGEuc291cmNlU2l6ZVxuICAgICAgICAgICAgICAgICAgICA/IGRhdGEuc291cmNlU2l6ZSA6IGRhdGEuZnJhbWU7XG4gICAgICAgICAgICAgICAgdmFyIG9yaWcgPSBuZXcgbWF0aC5SZWN0YW5nbGUoMCwgMCwgTWF0aC5mbG9vcihzb3VyY2VTaXplLncpIC8gdGhpcy5yZXNvbHV0aW9uLCBNYXRoLmZsb29yKHNvdXJjZVNpemUuaCkgLyB0aGlzLnJlc29sdXRpb24pO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnJvdGF0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSBuZXcgbWF0aC5SZWN0YW5nbGUoTWF0aC5mbG9vcihyZWN0LngpIC8gdGhpcy5yZXNvbHV0aW9uLCBNYXRoLmZsb29yKHJlY3QueSkgLyB0aGlzLnJlc29sdXRpb24sIE1hdGguZmxvb3IocmVjdC5oKSAvIHRoaXMucmVzb2x1dGlvbiwgTWF0aC5mbG9vcihyZWN0LncpIC8gdGhpcy5yZXNvbHV0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZyYW1lID0gbmV3IG1hdGguUmVjdGFuZ2xlKE1hdGguZmxvb3IocmVjdC54KSAvIHRoaXMucmVzb2x1dGlvbiwgTWF0aC5mbG9vcihyZWN0LnkpIC8gdGhpcy5yZXNvbHV0aW9uLCBNYXRoLmZsb29yKHJlY3QudykgLyB0aGlzLnJlc29sdXRpb24sIE1hdGguZmxvb3IocmVjdC5oKSAvIHRoaXMucmVzb2x1dGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vICBDaGVjayB0byBzZWUgaWYgdGhlIHNwcml0ZSBpcyB0cmltbWVkXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEudHJpbW1lZCAhPT0gZmFsc2UgJiYgZGF0YS5zcHJpdGVTb3VyY2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyaW0gPSBuZXcgbWF0aC5SZWN0YW5nbGUoTWF0aC5mbG9vcihkYXRhLnNwcml0ZVNvdXJjZVNpemUueCkgLyB0aGlzLnJlc29sdXRpb24sIE1hdGguZmxvb3IoZGF0YS5zcHJpdGVTb3VyY2VTaXplLnkpIC8gdGhpcy5yZXNvbHV0aW9uLCBNYXRoLmZsb29yKHJlY3QudykgLyB0aGlzLnJlc29sdXRpb24sIE1hdGguZmxvb3IocmVjdC5oKSAvIHRoaXMucmVzb2x1dGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZXNbaV0gPSBuZXcgY29yZS5UZXh0dXJlKHRoaXMuYmFzZVRleHR1cmUsIGZyYW1lLCBvcmlnLCB0cmltLCBkYXRhLnJvdGF0ZWQgPyAyIDogMCwgZGF0YS5hbmNob3IpO1xuICAgICAgICAgICAgICAgIC8vIGxldHMgYWxzbyBhZGQgdGhlIGZyYW1lIHRvIHBpeGkncyBnbG9iYWwgY2FjaGUgZm9yICdmcm9tJyBhbmQgJ2Zyb21Mb2FkZXInIGZ1bmN0aW9uc1xuICAgICAgICAgICAgICAgIGNvcmUuVGV4dHVyZS5hZGRUb0NhY2hlKHRoaXMudGV4dHVyZXNbaV0sIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJhbWVJbmRleCsrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKiogUGFyc2UgYW5pbWF0aW9ucyBjb25maWcuICovXG4gICAgU3ByaXRlc2hlZXQucHJvdG90eXBlLl9wcm9jZXNzQW5pbWF0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFuaW1hdGlvbnMgPSB0aGlzLmRhdGEuYW5pbWF0aW9ucyB8fCB7fTtcbiAgICAgICAgZm9yICh2YXIgYW5pbU5hbWUgaW4gYW5pbWF0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25zW2FuaW1OYW1lXSA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbmltYXRpb25zW2FuaW1OYW1lXS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBmcmFtZU5hbWUgPSBhbmltYXRpb25zW2FuaW1OYW1lXVtpXTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbnNbYW5pbU5hbWVdLnB1c2godGhpcy50ZXh0dXJlc1tmcmFtZU5hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqIFRoZSBwYXJzZSBoYXMgY29tcGxldGVkLiAqL1xuICAgIFNwcml0ZXNoZWV0LnByb3RvdHlwZS5fcGFyc2VDb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gdGhpcy5fY2FsbGJhY2s7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrID0gbnVsbDtcbiAgICAgICAgdGhpcy5fYmF0Y2hJbmRleCA9IDA7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgdGhpcy50ZXh0dXJlcyk7XG4gICAgfTtcbiAgICAvKiogQmVnaW4gdGhlIG5leHQgYmF0Y2ggb2YgdGV4dHVyZXMuICovXG4gICAgU3ByaXRlc2hlZXQucHJvdG90eXBlLl9uZXh0QmF0Y2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3Byb2Nlc3NGcmFtZXModGhpcy5fYmF0Y2hJbmRleCAqIFNwcml0ZXNoZWV0LkJBVENIX1NJWkUpO1xuICAgICAgICB0aGlzLl9iYXRjaEluZGV4Kys7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLl9iYXRjaEluZGV4ICogU3ByaXRlc2hlZXQuQkFUQ0hfU0laRSA8IF90aGlzLl9mcmFtZUtleXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX25leHRCYXRjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3Byb2Nlc3NBbmltYXRpb25zKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3BhcnNlQ29tcGxldGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBEZXN0cm95IFNwcml0ZXNoZWV0IGFuZCBkb24ndCB1c2UgYWZ0ZXIgdGhpcy5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXN0cm95QmFzZT1mYWxzZV0gLSBXaGV0aGVyIHRvIGRlc3Ryb3kgdGhlIGJhc2UgdGV4dHVyZSBhcyB3ZWxsXG4gICAgICovXG4gICAgU3ByaXRlc2hlZXQucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoZGVzdHJveUJhc2UpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoZGVzdHJveUJhc2UgPT09IHZvaWQgMCkgeyBkZXN0cm95QmFzZSA9IGZhbHNlOyB9XG4gICAgICAgIGZvciAodmFyIGkgaW4gdGhpcy50ZXh0dXJlcykge1xuICAgICAgICAgICAgdGhpcy50ZXh0dXJlc1tpXS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZnJhbWVzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZnJhbWVLZXlzID0gbnVsbDtcbiAgICAgICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgICAgICAgdGhpcy50ZXh0dXJlcyA9IG51bGw7XG4gICAgICAgIGlmIChkZXN0cm95QmFzZSkge1xuICAgICAgICAgICAgKF9hID0gdGhpcy5fdGV4dHVyZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuYmFzZVRleHR1cmUuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RleHR1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLmJhc2VUZXh0dXJlID0gbnVsbDtcbiAgICB9O1xuICAgIC8qKiBUaGUgbWF4aW11bSBudW1iZXIgb2YgVGV4dHVyZXMgdG8gYnVpbGQgcGVyIHByb2Nlc3MuICovXG4gICAgU3ByaXRlc2hlZXQuQkFUQ0hfU0laRSA9IDEwMDA7XG4gICAgcmV0dXJuIFNwcml0ZXNoZWV0O1xufSgpKTtcbi8qKlxuICogUmVmZXJlbmNlIHRvIFNwcml0ZXNoZWV0IG9iamVjdCBjcmVhdGVkLlxuICogQG1lbWJlciB7UElYSS5TcHJpdGVzaGVldH0gc3ByaXRlc2hlZXRcbiAqIEBtZW1iZXJvZiBQSVhJLkxvYWRlclJlc291cmNlXG4gKiBAaW5zdGFuY2VcbiAqL1xuLyoqXG4gKiBEaWN0aW9uYXJ5IG9mIHRleHR1cmVzIGZyb20gU3ByaXRlc2hlZXQuXG4gKiBAbWVtYmVyIHtPYmplY3Q8c3RyaW5nLCBQSVhJLlRleHR1cmU+fSB0ZXh0dXJlc1xuICogQG1lbWJlcm9mIFBJWEkuTG9hZGVyUmVzb3VyY2VcbiAqIEBpbnN0YW5jZVxuICovXG5cbi8qKlxuICoge0BsaW5rIFBJWEkuTG9hZGVyfSBtaWRkbGV3YXJlIGZvciBsb2FkaW5nIHRleHR1cmUgYXRsYXNlcyB0aGF0IGhhdmUgYmVlbiBjcmVhdGVkIHdpdGhcbiAqIFRleHR1cmVQYWNrZXIgb3Igc2ltaWxhciBKU09OLWJhc2VkIHNwcml0ZXNoZWV0LlxuICpcbiAqIFRoaXMgbWlkZGxld2FyZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlcyBUZXh0dXJlIHJlc291cmNlcy5cbiAqXG4gKiBJZiB5b3UncmUgdXNpbmcgV2VicGFjayBvciBvdGhlciBidW5kbGVycyBhbmQgcGxhbiBvbiBidW5kbGluZyB0aGUgYXRsYXMnIEpTT04sXG4gKiB1c2UgdGhlIHtAbGluayBQSVhJLlNwcml0ZXNoZWV0fSBjbGFzcyB0byBkaXJlY3RseSBwYXJzZSB0aGUgSlNPTi5cbiAqXG4gKiBUaGUgTG9hZGVyJ3MgaW1hZ2UgUmVzb3VyY2UgbmFtZSBpcyBhdXRvbWF0aWNhbGx5IGFwcGVuZGVkIHdpdGggYFwiX2ltYWdlXCJgLlxuICogSWYgYSBSZXNvdXJjZSB3aXRoIHRoaXMgbmFtZSBpcyBhbHJlYWR5IGxvYWRlZCwgdGhlIExvYWRlciB3aWxsIHNraXAgcGFyc2luZyB0aGVcbiAqIFNwcml0ZXNoZWV0LiBUaGUgY29kZSBiZWxvdyB3aWxsIGdlbmVyYXRlIGFuIGludGVybmFsIExvYWRlciBSZXNvdXJjZSBjYWxsZWQgYFwibXlhdGxhc19pbWFnZVwiYC5cbiAqIEBleGFtcGxlXG4gKiBsb2FkZXIuYWRkKCdteWF0bGFzJywgJ3BhdGgvdG8vbXlhdGxhcy5qc29uJyk7XG4gKiBsb2FkZXIubG9hZCgoKSA9PiB7XG4gKiAgIGxvYWRlci5yZXNvdXJjZXMubXlhdGxhczsgLy8gYXRsYXMgSlNPTiByZXNvdXJjZVxuICogICBsb2FkZXIucmVzb3VyY2VzLm15YXRsYXNfaW1hZ2U7IC8vIGF0bGFzIEltYWdlIHJlc291cmNlXG4gKiB9KTtcbiAqIEBtZW1iZXJvZiBQSVhJXG4gKi9cbnZhciBTcHJpdGVzaGVldExvYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTcHJpdGVzaGVldExvYWRlcigpIHtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGVkIGFmdGVyIGEgcmVzb3VyY2UgaXMgbG9hZGVkLlxuICAgICAqIEBzZWUgUElYSS5Mb2FkZXIubG9hZGVyTWlkZGxld2FyZVxuICAgICAqIEBwYXJhbSByZXNvdXJjZVxuICAgICAqIEBwYXJhbSBuZXh0XG4gICAgICovXG4gICAgU3ByaXRlc2hlZXRMb2FkZXIudXNlID0gZnVuY3Rpb24gKHJlc291cmNlLCBuZXh0KSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIC8vIGJlY2F1c2UgdGhpcyBpcyBtaWRkbGV3YXJlLCBpdCBleGVjdXRlIGluIGxvYWRlciBjb250ZXh0LiBgdGhpc2AgPSBsb2FkZXJcbiAgICAgICAgdmFyIGxvYWRlciA9IHRoaXM7XG4gICAgICAgIHZhciBpbWFnZVJlc291cmNlTmFtZSA9IHJlc291cmNlLm5hbWUgKyBcIl9pbWFnZVwiO1xuICAgICAgICAvLyBza2lwIGlmIG5vIGRhdGEsIGl0cyBub3QganNvbiwgaXQgaXNuJ3Qgc3ByaXRlc2hlZXQgZGF0YSwgb3IgdGhlIGltYWdlIHJlc291cmNlIGFscmVhZHkgZXhpc3RzXG4gICAgICAgIGlmICghcmVzb3VyY2UuZGF0YVxuICAgICAgICAgICAgfHwgcmVzb3VyY2UudHlwZSAhPT0gbG9hZGVycy5Mb2FkZXJSZXNvdXJjZS5UWVBFLkpTT05cbiAgICAgICAgICAgIHx8ICFyZXNvdXJjZS5kYXRhLmZyYW1lc1xuICAgICAgICAgICAgfHwgbG9hZGVyLnJlc291cmNlc1tpbWFnZVJlc291cmNlTmFtZV0pIHtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBhbmQgYWRkIHRoZSBtdWx0aSBhdGxhc1xuICAgICAgICAvLyBIZWF2aWx5IGluZmx1ZW5jZWQgYW5kIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2NrZXQtdWEvcGl4aS10cHMtbG9hZGVyL2Jsb2IvbWFzdGVyL3NyYy9SZXNvdXJjZUxvYWRlci5qc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG4gICAgICAgIHZhciBtdWx0aVBhY2tzID0gKF9iID0gKF9hID0gcmVzb3VyY2UuZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1ldGEpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZWxhdGVkX211bHRpX3BhY2tzO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtdWx0aVBhY2tzKSkge1xuICAgICAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29udGludWVcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1OYW1lID0gaXRlbS5yZXBsYWNlKCcuanNvbicsICcnKTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbVVybCA9IHV0aWxzLnVybC5yZXNvbHZlKHJlc291cmNlLnVybC5yZXBsYWNlKGxvYWRlci5iYXNlVXJsLCAnJyksIGl0ZW0pO1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBmaWxlIHdhc24ndCBhbHJlYWR5IGFkZGVkIGFzIG11bHRpcGFja3MgYXJlIHJlZHVuZGFudFxuICAgICAgICAgICAgICAgIGlmIChsb2FkZXIucmVzb3VyY2VzW2l0ZW1OYW1lXVxuICAgICAgICAgICAgICAgICAgICB8fCBPYmplY3QudmFsdWVzKGxvYWRlci5yZXNvdXJjZXMpLnNvbWUoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHV0aWxzLnVybC5mb3JtYXQodXRpbHMudXJsLnBhcnNlKHIudXJsKSkgPT09IGl0ZW1Vcmw7IH0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImNvbnRpbnVlXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICBjcm9zc09yaWdpbjogcmVzb3VyY2UuY3Jvc3NPcmlnaW4sXG4gICAgICAgICAgICAgICAgICAgIGxvYWRUeXBlOiBsb2FkZXJzLkxvYWRlclJlc291cmNlLkxPQURfVFlQRS5YSFIsXG4gICAgICAgICAgICAgICAgICAgIHhoclR5cGU6IGxvYWRlcnMuTG9hZGVyUmVzb3VyY2UuWEhSX1JFU1BPTlNFX1RZUEUuSlNPTixcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50UmVzb3VyY2U6IHJlc291cmNlLFxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YTogcmVzb3VyY2UubWV0YWRhdGFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGxvYWRlci5hZGQoaXRlbU5hbWUsIGl0ZW1VcmwsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgbXVsdGlQYWNrc18xID0gbXVsdGlQYWNrczsgX2kgPCBtdWx0aVBhY2tzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBtdWx0aVBhY2tzXzFbX2ldO1xuICAgICAgICAgICAgICAgIF9sb29wXzEoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxvYWRPcHRpb25zID0ge1xuICAgICAgICAgICAgY3Jvc3NPcmlnaW46IHJlc291cmNlLmNyb3NzT3JpZ2luLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHJlc291cmNlLm1ldGFkYXRhLmltYWdlTWV0YWRhdGEsXG4gICAgICAgICAgICBwYXJlbnRSZXNvdXJjZTogcmVzb3VyY2UsXG4gICAgICAgIH07XG4gICAgICAgIHZhciByZXNvdXJjZVBhdGggPSBTcHJpdGVzaGVldExvYWRlci5nZXRSZXNvdXJjZVBhdGgocmVzb3VyY2UsIGxvYWRlci5iYXNlVXJsKTtcbiAgICAgICAgLy8gbG9hZCB0aGUgaW1hZ2UgZm9yIHRoaXMgc2hlZXRcbiAgICAgICAgbG9hZGVyLmFkZChpbWFnZVJlc291cmNlTmFtZSwgcmVzb3VyY2VQYXRoLCBsb2FkT3B0aW9ucywgZnVuY3Rpb24gb25JbWFnZUxvYWQocmVzKSB7XG4gICAgICAgICAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV4dChyZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzcHJpdGVzaGVldCA9IG5ldyBTcHJpdGVzaGVldChyZXMudGV4dHVyZSwgcmVzb3VyY2UuZGF0YSwgcmVzb3VyY2UudXJsKTtcbiAgICAgICAgICAgIHNwcml0ZXNoZWV0LnBhcnNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXNvdXJjZS5zcHJpdGVzaGVldCA9IHNwcml0ZXNoZWV0O1xuICAgICAgICAgICAgICAgIHJlc291cmNlLnRleHR1cmVzID0gc3ByaXRlc2hlZXQudGV4dHVyZXM7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBzcHJpdGVzaGVldHMgcm9vdCBwYXRoXG4gICAgICogQHBhcmFtIHJlc291cmNlIC0gUmVzb3VyY2UgdG8gY2hlY2sgcGF0aFxuICAgICAqIEBwYXJhbSBiYXNlVXJsIC0gQmFzZSByb290IHVybFxuICAgICAqL1xuICAgIFNwcml0ZXNoZWV0TG9hZGVyLmdldFJlc291cmNlUGF0aCA9IGZ1bmN0aW9uIChyZXNvdXJjZSwgYmFzZVVybCkge1xuICAgICAgICAvLyBQcmVwZW5kIHVybCBwYXRoIHVubGVzcyB0aGUgcmVzb3VyY2UgaW1hZ2UgaXMgYSBkYXRhIHVybFxuICAgICAgICBpZiAocmVzb3VyY2UuaXNEYXRhVXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2UuZGF0YS5tZXRhLmltYWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1dGlscy51cmwucmVzb2x2ZShyZXNvdXJjZS51cmwucmVwbGFjZShiYXNlVXJsLCAnJyksIHJlc291cmNlLmRhdGEubWV0YS5pbWFnZSk7XG4gICAgfTtcbiAgICByZXR1cm4gU3ByaXRlc2hlZXRMb2FkZXI7XG59KCkpO1xuXG5leHBvcnRzLlNwcml0ZXNoZWV0ID0gU3ByaXRlc2hlZXQ7XG5leHBvcnRzLlNwcml0ZXNoZWV0TG9hZGVyID0gU3ByaXRlc2hlZXRMb2FkZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zcHJpdGVzaGVldC5qcy5tYXBcbiJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIm1hdGgiLCJjb3JlIiwidXRpbHMiLCJsb2FkZXJzIiwiU3ByaXRlc2hlZXQiLCJ0ZXh0dXJlIiwiZGF0YSIsInJlc29sdXRpb25GaWxlbmFtZSIsInRoaXMiLCJfdGV4dHVyZSIsIlRleHR1cmUiLCJiYXNlVGV4dHVyZSIsIkJhc2VUZXh0dXJlIiwidGV4dHVyZXMiLCJhbmltYXRpb25zIiwicmVzb3VyY2UiLCJyZXNvbHV0aW9uIiwiX3VwZGF0ZVJlc29sdXRpb24iLCJ1cmwiLCJfZnJhbWVzIiwiZnJhbWVzIiwiX2ZyYW1lS2V5cyIsImtleXMiLCJfYmF0Y2hJbmRleCIsIl9jYWxsYmFjayIsInByb3RvdHlwZSIsInNjYWxlIiwibWV0YSIsImdldFJlc29sdXRpb25PZlVybCIsInVuZGVmaW5lZCIsInBhcnNlRmxvYXQiLCJzZXRSZXNvbHV0aW9uIiwicGFyc2UiLCJjYWxsYmFjayIsImxlbmd0aCIsIkJBVENIX1NJWkUiLCJfcHJvY2Vzc0ZyYW1lcyIsIl9wcm9jZXNzQW5pbWF0aW9ucyIsIl9wYXJzZUNvbXBsZXRlIiwiX25leHRCYXRjaCIsImluaXRpYWxGcmFtZUluZGV4IiwiZnJhbWVJbmRleCIsIm1heEZyYW1lcyIsImkiLCJyZWN0IiwiZnJhbWUiLCJ0cmltIiwic291cmNlU2l6ZSIsInRyaW1tZWQiLCJvcmlnIiwiUmVjdGFuZ2xlIiwiTWF0aCIsImZsb29yIiwidyIsImgiLCJyb3RhdGVkIiwieCIsInkiLCJzcHJpdGVTb3VyY2VTaXplIiwiYW5jaG9yIiwiYWRkVG9DYWNoZSIsImFuaW1OYW1lIiwiZnJhbWVOYW1lIiwicHVzaCIsImNhbGwiLCJfdGhpcyIsInNldFRpbWVvdXQiLCJkZXN0cm95IiwiZGVzdHJveUJhc2UiLCJfYSIsIlNwcml0ZXNoZWV0TG9hZGVyIiwidXNlIiwibmV4dCIsIl9iIiwibG9hZGVyIiwiaW1hZ2VSZXNvdXJjZU5hbWUiLCJuYW1lIiwidHlwZSIsIkxvYWRlclJlc291cmNlIiwiVFlQRSIsIkpTT04iLCJyZXNvdXJjZXMiLCJtdWx0aVBhY2tzIiwicmVsYXRlZF9tdWx0aV9wYWNrcyIsIkFycmF5IiwiaXNBcnJheSIsIl9sb29wXzEiLCJpdGVtIiwiaXRlbU5hbWUiLCJyZXBsYWNlIiwiaXRlbVVybCIsInJlc29sdmUiLCJiYXNlVXJsIiwidmFsdWVzIiwic29tZSIsInIiLCJmb3JtYXQiLCJvcHRpb25zIiwiY3Jvc3NPcmlnaW4iLCJsb2FkVHlwZSIsIkxPQURfVFlQRSIsIlhIUiIsInhoclR5cGUiLCJYSFJfUkVTUE9OU0VfVFlQRSIsInBhcmVudFJlc291cmNlIiwibWV0YWRhdGEiLCJhZGQiLCJfaSIsIm11bHRpUGFja3NfMSIsImxvYWRPcHRpb25zIiwiaW1hZ2VNZXRhZGF0YSIsInJlc291cmNlUGF0aCIsImdldFJlc291cmNlUGF0aCIsInJlcyIsImVycm9yIiwic3ByaXRlc2hlZXQiLCJpc0RhdGFVcmwiLCJpbWFnZSJdLCJzb3VyY2VSb290IjoiIn0=