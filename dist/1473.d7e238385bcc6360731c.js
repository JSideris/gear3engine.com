"use strict";(self.webpackChunkgear3engine_website=self.webpackChunkgear3engine_website||[]).push([[1473],{1473:(t,e,r)=>{r.d(e,{Kj:()=>p,rY:()=>v,xc:()=>y});var i=r(5307),n=r(4295),a=r(7054),o=r(29),s=r(1573),u=r(5323),h=function(t,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},h(t,e)};function l(t,e){function r(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var d=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),f=new n.E9,c=new n.mg,p=function(t){function e(e,r,n,o){void 0===o&&(o=a.lg.TRIANGLES);var u=t.call(this)||this;return u.geometry=e,e.refCount++,u.shader=r,u.state=n||i.ZM.for2d(),u.drawMode=o,u.start=0,u.size=0,u.uvs=null,u.indices=null,u.vertexData=new Float32Array(1),u.vertexDirty=0,u._transformID=-1,u._roundPixels=s.X.ROUND_PIXELS,u.batchUvs=null,u}return l(e,t),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this.shader.tint},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===a.lg.TRIANGLES&&r.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var r=this.transform.worldTransform,i=r.a,n=r.b,a=r.c,o=r.d,u=r.tx,h=r.ty,l=this.vertexData,d=0;d<l.length/2;d++){var f=e[2*d],c=e[2*d+1];l[2*d]=i*f+a*c+u,l[2*d+1]=n*f+o*c+h}if(this._roundPixels){var p=s.X.RESOLUTION;for(d=0;d<l.length;++d)l[d]=Math.round((l[d]*p|0)/p)}this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new d(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,f);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=c.points,i=this.geometry.getIndex().data,n=i.length,a=4===this.drawMode?3:1,o=0;o+2<n;o+=a){var s=2*i[o],u=2*i[o+1],h=2*i[o+2];if(r[0]=e[s],r[1]=e[s+1],r[2]=e[u],r[3]=e[u+1],r[4]=e[h],r[5]=e[h+1],c.contains(f.x,f.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(o.W2),v=function(t){function e(e,r){var a=this,o={uSampler:e,alpha:1,uTextureMatrix:n.y3.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(o,r.uniforms),(a=t.call(this,r.program||i.$r.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),o)||this)._colorDirty=!1,a.uvMatrix=new i.UX(e),a.batchable=void 0===r.program,a.pluginName=r.pluginName,a.tint=r.tint,a.alpha=r.alpha,a}return l(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;(0,u.premultiplyTintToRgba)(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(i.ex),y=function(t){function e(e,r,n){var o=t.call(this)||this,s=new i.lW(e),u=new i.lW(r,!0),h=new i.lW(n,!0,!0);return o.addAttribute("aVertexPosition",s,2,!1,a.vK.FLOAT).addAttribute("aTextureCoord",u,2,!1,a.vK.FLOAT).addIndex(h),o._updateId=-1,o}return l(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(i.ZX)}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUtnRyxHQUNqQyxJQUFJckcsRUFBUUwsRUFBT00sS0FBS3pCLE9BQVNBLEtBQzdCOEgsRUFBaUIsSUFBSSxLQUFPOUUsR0FDNUIrRSxFQUFZLElBQUksS0FBT2xHLEdBQUssR0FDNUJ3QyxFQUFjLElBQUksS0FBT3dELEdBQU8sR0FBTSxHQWExQyxPQVpBckcsRUFBTXdHLGFBQWEsa0JBQW1CRixFQUFnQixHQUFHLEVBQU8sWUFDM0RFLGFBQWEsZ0JBQWlCRCxFQUFXLEdBQUcsRUFBTyxZQUNuREUsU0FBUzVELEdBU2Q3QyxFQUFNMEcsV0FBYSxFQUNaMUcsQ0FDWCxDQWNBLE9BdENBMUIsRUFBVThILEVBQWN6RyxHQXlCeEIzQixPQUFPNEMsZUFBZXdGLEVBQWExSCxVQUFXLGdCQUFpQixDQU8zRG1DLElBQUssV0FDRCxPQUFPckMsS0FBS3NDLFFBQVEsR0FBRzVCLFNBQzNCLEVBQ0E2QixZQUFZLEVBQ1pDLGNBQWMsSUFFWG9GLENBQ1gsQ0F4Q2lDLENBd0MvQixLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ2VhcjNlbmdpbmUtd2Vic2l0ZS8uL25vZGVfbW9kdWxlcy9AcGl4aS9tZXNoL2xpYi9tZXNoLmVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQHBpeGkvbWVzaCAtIHY1LjMuMTJcbiAqIENvbXBpbGVkIFdlZCwgMjMgTWFyIDIwMjIgMTg6MzQ6MjggVVRDXG4gKlxuICogQHBpeGkvbWVzaCBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4gKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlXG4gKi9cbmltcG9ydCB7IFN0YXRlLCBQcm9ncmFtLCBUZXh0dXJlTWF0cml4LCBTaGFkZXIsIEJ1ZmZlciwgR2VvbWV0cnkgfSBmcm9tICdAcGl4aS9jb3JlJztcbmltcG9ydCB7IFBvaW50LCBQb2x5Z29uLCBNYXRyaXggfSBmcm9tICdAcGl4aS9tYXRoJztcbmltcG9ydCB7IERSQVdfTU9ERVMsIFRZUEVTIH0gZnJvbSAnQHBpeGkvY29uc3RhbnRzJztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJ0BwaXhpL2Rpc3BsYXknO1xuaW1wb3J0IHsgc2V0dGluZ3MgfSBmcm9tICdAcGl4aS9zZXR0aW5ncyc7XG5pbXBvcnQgeyBwcmVtdWx0aXBseVRpbnRUb1JnYmEgfSBmcm9tICdAcGl4aS91dGlscyc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXHJcbnRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXHJcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5USElTIENPREUgSVMgUFJPVklERUQgT04gQU4gKkFTIElTKiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXHJcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcclxuV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSxcclxuTUVSQ0hBTlRBQkxJVFkgT1IgTk9OLUlORlJJTkdFTUVOVC5cclxuXHJcblNlZSB0aGUgQXBhY2hlIFZlcnNpb24gMi4wIExpY2Vuc2UgZm9yIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xyXG5hbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0gfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxuXG4vKipcbiAqIENsYXNzIGNvbnRyb2xzIGNhY2hlIGZvciBVViBtYXBwaW5nIGZyb20gVGV4dHVyZSBub3JtYWwgc3BhY2UgdG8gQmFzZVRleHR1cmUgbm9ybWFsIHNwYWNlLlxuICpcbiAqIEBjbGFzc1xuICogQG1lbWJlcm9mIFBJWElcbiAqL1xudmFyIE1lc2hCYXRjaFV2cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1BJWEkuQnVmZmVyfSB1dkJ1ZmZlciAtIEJ1ZmZlciB3aXRoIG5vcm1hbGl6ZWQgdXYnc1xuICAgICAqIEBwYXJhbSB7UElYSS5UZXh0dXJlTWF0cml4fSB1dk1hdHJpeCAtIE1hdGVyaWFsIFVWIG1hdHJpeFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE1lc2hCYXRjaFV2cyh1dkJ1ZmZlciwgdXZNYXRyaXgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJ1ZmZlciB3aXRoIG5vcm1hbGl6ZWQgVVYnc1xuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLkJ1ZmZlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXZCdWZmZXIgPSB1dkJ1ZmZlcjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hdGVyaWFsIFVWIG1hdHJpeFxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLlRleHR1cmVNYXRyaXh9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnV2TWF0cml4ID0gdXZNYXRyaXg7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVViBCdWZmZXIgZGF0YVxuICAgICAgICAgKiBAbWVtYmVyIHtGbG9hdDMyQXJyYXl9XG4gICAgICAgICAqIEByZWFkb25seVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYXRhID0gbnVsbDtcbiAgICAgICAgdGhpcy5fYnVmZmVyVXBkYXRlSWQgPSAtMTtcbiAgICAgICAgdGhpcy5fdGV4dHVyZVVwZGF0ZUlkID0gLTE7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUlEID0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogdXBkYXRlc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbZm9yY2VVcGRhdGVdIC0gZm9yY2UgdGhlIHVwZGF0ZVxuICAgICAqL1xuICAgIE1lc2hCYXRjaFV2cy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGZvcmNlVXBkYXRlKSB7XG4gICAgICAgIGlmICghZm9yY2VVcGRhdGVcbiAgICAgICAgICAgICYmIHRoaXMuX2J1ZmZlclVwZGF0ZUlkID09PSB0aGlzLnV2QnVmZmVyLl91cGRhdGVJRFxuICAgICAgICAgICAgJiYgdGhpcy5fdGV4dHVyZVVwZGF0ZUlkID09PSB0aGlzLnV2TWF0cml4Ll91cGRhdGVJRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2J1ZmZlclVwZGF0ZUlkID0gdGhpcy51dkJ1ZmZlci5fdXBkYXRlSUQ7XG4gICAgICAgIHRoaXMuX3RleHR1cmVVcGRhdGVJZCA9IHRoaXMudXZNYXRyaXguX3VwZGF0ZUlEO1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMudXZCdWZmZXIuZGF0YTtcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEgfHwgdGhpcy5kYXRhLmxlbmd0aCAhPT0gZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoZGF0YS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXZNYXRyaXgubXVsdGlwbHlVdnMoZGF0YSwgdGhpcy5kYXRhKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlSUQrKztcbiAgICB9O1xuICAgIHJldHVybiBNZXNoQmF0Y2hVdnM7XG59KCkpO1xuXG52YXIgdGVtcFBvaW50ID0gbmV3IFBvaW50KCk7XG52YXIgdGVtcFBvbHlnb24gPSBuZXcgUG9seWdvbigpO1xuLyoqXG4gKiBCYXNlIG1lc2ggY2xhc3MuXG4gKlxuICogVGhpcyBjbGFzcyBlbXBvd2VycyB5b3UgdG8gaGF2ZSBtYXhpbXVtIGZsZXhpYmlsaXR5IHRvIHJlbmRlciBhbnkga2luZCBvZiBXZWJHTCB2aXN1YWxzIHlvdSBjYW4gdGhpbmsgb2YuXG4gKiBUaGlzIGNsYXNzIGFzc3VtZXMgYSBjZXJ0YWluIGxldmVsIG9mIFdlYkdMIGtub3dsZWRnZS5cbiAqIElmIHlvdSBrbm93IGEgYml0IHRoaXMgc2hvdWxkIGFic3RyYWN0IGVub3VnaCBhd2F5IHRvIG1ha2UgeW91IGxpZmUgZWFzaWVyIVxuICpcbiAqIFByZXR0eSBtdWNoIEFMTCBXZWJHTCBjYW4gYmUgYnJva2VuIGRvd24gaW50byB0aGUgZm9sbG93aW5nOlxuICogLSBHZW9tZXRyeSAtIFRoZSBzdHJ1Y3R1cmUgYW5kIGRhdGEgZm9yIHRoZSBtZXNoLiBUaGlzIGNhbiBpbmNsdWRlIGFueXRoaW5nIGZyb20gcG9zaXRpb25zLCB1dnMsIG5vcm1hbHMsIGNvbG9ycyBldGMuLlxuICogLSBTaGFkZXIgLSBUaGlzIGlzIHRoZSBzaGFkZXIgdGhhdCBQaXhpSlMgd2lsbCByZW5kZXIgdGhlIGdlb21ldHJ5IHdpdGggKGF0dHJpYnV0ZXMgaW4gdGhlIHNoYWRlciBtdXN0IG1hdGNoIHRoZSBnZW9tZXRyeSlcbiAqIC0gU3RhdGUgLSBUaGlzIGlzIHRoZSBzdGF0ZSBvZiBXZWJHTCByZXF1aXJlZCB0byByZW5kZXIgdGhlIG1lc2guXG4gKlxuICogVGhyb3VnaCBhIGNvbWJpbmF0aW9uIG9mIHRoZSBhYm92ZSBlbGVtZW50cyB5b3UgY2FuIHJlbmRlciBhbnl0aGluZyB5b3Ugd2FudCwgMkQgb3IgM0QhXG4gKlxuICogQGNsYXNzXG4gKiBAZXh0ZW5kcyBQSVhJLkNvbnRhaW5lclxuICogQG1lbWJlcm9mIFBJWElcbiAqL1xudmFyIE1lc2ggPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1lc2gsIF9zdXBlcik7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtQSVhJLkdlb21ldHJ5fSBnZW9tZXRyeSAtIHRoZSBnZW9tZXRyeSB0aGUgbWVzaCB3aWxsIHVzZVxuICAgICAqIEBwYXJhbSB7UElYSS5NZXNoTWF0ZXJpYWx9IHNoYWRlciAtIHRoZSBzaGFkZXIgdGhlIG1lc2ggd2lsbCB1c2VcbiAgICAgKiBAcGFyYW0ge1BJWEkuU3RhdGV9IFtzdGF0ZV0gLSB0aGUgc3RhdGUgdGhhdCB0aGUgV2ViR0wgY29udGV4dCBpcyByZXF1aXJlZCB0byBiZSBpbiB0byByZW5kZXIgdGhlIG1lc2hcbiAgICAgKiAgICAgICAgaWYgbm8gc3RhdGUgaXMgcHJvdmlkZWQsIHVzZXMge0BsaW5rIFBJWEkuU3RhdGUuZm9yMmR9IHRvIGNyZWF0ZSBhIDJEIHN0YXRlIGZvciBQaXhpSlMuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtkcmF3TW9kZT1QSVhJLkRSQVdfTU9ERVMuVFJJQU5HTEVTXSAtIHRoZSBkcmF3TW9kZSwgY2FuIGJlIGFueSBvZiB0aGUgUElYSS5EUkFXX01PREVTIGNvbnN0c1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIE1lc2goZ2VvbWV0cnksIHNoYWRlciwgc3RhdGUsIGRyYXdNb2RlKSB7XG4gICAgICAgIGlmIChkcmF3TW9kZSA9PT0gdm9pZCAwKSB7IGRyYXdNb2RlID0gRFJBV19NT0RFUy5UUklBTkdMRVM7IH1cbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluY2x1ZGVzIHZlcnRleCBwb3NpdGlvbnMsIGZhY2UgaW5kaWNlcywgbm9ybWFscywgY29sb3JzLCBVVnMsIGFuZFxuICAgICAgICAgKiBjdXN0b20gYXR0cmlidXRlcyB3aXRoaW4gYnVmZmVycywgcmVkdWNpbmcgdGhlIGNvc3Qgb2YgcGFzc2luZyBhbGxcbiAgICAgICAgICogdGhpcyBkYXRhIHRvIHRoZSBHUFUuIENhbiBiZSBzaGFyZWQgYmV0d2VlbiBtdWx0aXBsZSBNZXNoIG9iamVjdHMuXG4gICAgICAgICAqIEBtZW1iZXIge1BJWEkuR2VvbWV0cnl9XG4gICAgICAgICAqIEByZWFkb25seVxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMuZ2VvbWV0cnkgPSBnZW9tZXRyeTtcbiAgICAgICAgZ2VvbWV0cnkucmVmQ291bnQrKztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlcHJlc2VudHMgdGhlIHZlcnRleCBhbmQgZnJhZ21lbnQgc2hhZGVycyB0aGF0IHByb2Nlc3NlcyB0aGUgZ2VvbWV0cnkgYW5kIHJ1bnMgb24gdGhlIEdQVS5cbiAgICAgICAgICogQ2FuIGJlIHNoYXJlZCBiZXR3ZWVuIG11bHRpcGxlIE1lc2ggb2JqZWN0cy5cbiAgICAgICAgICogQG1lbWJlciB7UElYSS5TaGFkZXJ8UElYSS5NZXNoTWF0ZXJpYWx9XG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5zaGFkZXIgPSBzaGFkZXI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXByZXNlbnRzIHRoZSBXZWJHTCBzdGF0ZSB0aGUgTWVzaCByZXF1aXJlZCB0byByZW5kZXIsIGV4Y2x1ZGVzIHNoYWRlciBhbmQgZ2VvbWV0cnkuIEUuZy4sXG4gICAgICAgICAqIGJsZW5kIG1vZGUsIGN1bGxpbmcsIGRlcHRoIHRlc3RpbmcsIGRpcmVjdGlvbiBvZiByZW5kZXJpbmcgdHJpYW5nbGVzLCBiYWNrZmFjZSwgZXRjLlxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLlN0YXRlfVxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMuc3RhdGUgPSBzdGF0ZSB8fCBTdGF0ZS5mb3IyZCgpO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHdheSB0aGUgTWVzaCBzaG91bGQgYmUgZHJhd24sIGNhbiBiZSBhbnkgb2YgdGhlIHtAbGluayBQSVhJLkRSQVdfTU9ERVN9IGNvbnN0YW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAgICAgKiBAc2VlIFBJWEkuRFJBV19NT0RFU1xuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMuZHJhd01vZGUgPSBkcmF3TW9kZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFR5cGljYWxseSB0aGUgaW5kZXggb2YgdGhlIEluZGV4QnVmZmVyIHdoZXJlIHRvIHN0YXJ0IGRyYXdpbmcuXG4gICAgICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgICAgICogQGRlZmF1bHQgMFxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMuc3RhcnQgPSAwO1xuICAgICAgICAvKipcbiAgICAgICAgICogSG93IG11Y2ggb2YgdGhlIGdlb21ldHJ5IHRvIGRyYXcsIGJ5IGRlZmF1bHQgYDBgIHJlbmRlcnMgZXZlcnl0aGluZy5cbiAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAgICAgKiBAZGVmYXVsdCAwXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5zaXplID0gMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRoZWFzZSBhcmUgdXNlZCBhcyBlYXN5IGFjY2VzcyBmb3IgYmF0Y2hpbmdcbiAgICAgICAgICogQG1lbWJlciB7RmxvYXQzMkFycmF5fVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMudXZzID0gbnVsbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRoZWFzZSBhcmUgdXNlZCBhcyBlYXN5IGFjY2VzcyBmb3IgYmF0Y2hpbmdcbiAgICAgICAgICogQG1lbWJlciB7VWludDE2QXJyYXl9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5pbmRpY2VzID0gbnVsbDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRoaXMgaXMgdGhlIGNhY2hpbmcgbGF5ZXIgdXNlZCBieSB0aGUgYmF0Y2hlclxuICAgICAgICAgKiBAbWVtYmVyIHtGbG9hdDMyQXJyYXl9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy52ZXJ0ZXhEYXRhID0gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIGdlb21ldHJ5IGlzIGNoYW5nZWQgdXNlZCB0byBkZWNpZGUgdG8gcmUtdHJhbnNmb3JtXG4gICAgICAgICAqIHRoZSB2ZXJ0ZXhEYXRhLlxuICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy52ZXJ0ZXhEaXJ0eSA9IDA7XG4gICAgICAgIF90aGlzLl90cmFuc2Zvcm1JRCA9IC0xO1xuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgcm91bmRQaXhlbHMgZmllbGRcbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7Ym9vbGVhbn1cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF90aGlzLl9yb3VuZFBpeGVscyA9IHNldHRpbmdzLlJPVU5EX1BJWEVMUztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJhdGNoZWQgVVYncyBhcmUgY2FjaGVkIGZvciBhdGxhcyB0ZXh0dXJlc1xuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLk1lc2hCYXRjaFV2c31cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF90aGlzLmJhdGNoVXZzID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwidXZCdWZmZXJcIiwge1xuICAgICAgICAvKipcbiAgICAgICAgICogVG8gY2hhbmdlIG1lc2ggdXYncywgY2hhbmdlIGl0cyB1dkJ1ZmZlciBkYXRhIGFuZCBpbmNyZW1lbnQgaXRzIF91cGRhdGVJRC5cbiAgICAgICAgICogQG1lbWJlciB7UElYSS5CdWZmZXJ9XG4gICAgICAgICAqIEByZWFkb25seVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZW9tZXRyeS5idWZmZXJzWzFdO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2gucHJvdG90eXBlLCBcInZlcnRpY2VzQnVmZmVyXCIsIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvIGNoYW5nZSBtZXNoIHZlcnRpY2VzLCBjaGFuZ2UgaXRzIHV2QnVmZmVyIGRhdGEgYW5kIGluY3JlbWVudCBpdHMgX3VwZGF0ZUlELlxuICAgICAgICAgKiBJbmNyZW1lbnRpbmcgX3VwZGF0ZUlEIGlzIG9wdGlvbmFsIGJlY2F1c2UgbW9zdCBvZiBNZXNoIG9iamVjdHMgZG8gaXQgYW55d2F5LlxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLkJ1ZmZlcn1cbiAgICAgICAgICogQHJlYWRvbmx5XG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdlb21ldHJ5LmJ1ZmZlcnNbMF07XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwibWF0ZXJpYWxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNoYWRlcjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFsaWFzIGZvciB7QGxpbmsgUElYSS5NZXNoI3NoYWRlcn0uXG4gICAgICAgICAqIEBtZW1iZXIge1BJWEkuTWVzaE1hdGVyaWFsfVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2hhZGVyID0gdmFsdWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwiYmxlbmRNb2RlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5ibGVuZE1vZGU7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYmxlbmQgbW9kZSB0byBiZSBhcHBsaWVkIHRvIHRoZSBNZXNoLiBBcHBseSBhIHZhbHVlIG9mXG4gICAgICAgICAqIGBQSVhJLkJMRU5EX01PREVTLk5PUk1BTGAgdG8gcmVzZXQgdGhlIGJsZW5kIG1vZGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgICAgICogQGRlZmF1bHQgUElYSS5CTEVORF9NT0RFUy5OT1JNQUw7XG4gICAgICAgICAqIEBzZWUgUElYSS5CTEVORF9NT0RFU1xuICAgICAgICAgKi9cbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuYmxlbmRNb2RlID0gdmFsdWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwicm91bmRQaXhlbHNcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yb3VuZFBpeGVscztcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIHRydWUgUGl4aUpTIHdpbGwgTWF0aC5mbG9vcigpIHgveSB2YWx1ZXMgd2hlbiByZW5kZXJpbmcsIHN0b3BwaW5nIHBpeGVsIGludGVycG9sYXRpb24uXG4gICAgICAgICAqIEFkdmFudGFnZXMgY2FuIGluY2x1ZGUgc2hhcnBlciBpbWFnZSBxdWFsaXR5IChsaWtlIHRleHQpIGFuZCBmYXN0ZXIgcmVuZGVyaW5nIG9uIGNhbnZhcy5cbiAgICAgICAgICogVGhlIG1haW4gZGlzYWR2YW50YWdlIGlzIG1vdmVtZW50IG9mIG9iamVjdHMgbWF5IGFwcGVhciBsZXNzIHNtb290aC5cbiAgICAgICAgICogVG8gc2V0IHRoZSBnbG9iYWwgZGVmYXVsdCwgY2hhbmdlIHtAbGluayBQSVhJLnNldHRpbmdzLlJPVU5EX1BJWEVMU31cbiAgICAgICAgICpcbiAgICAgICAgICogQG1lbWJlciB7Ym9vbGVhbn1cbiAgICAgICAgICogQGRlZmF1bHQgZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fcm91bmRQaXhlbHMgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNmb3JtSUQgPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3JvdW5kUGl4ZWxzID0gdmFsdWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwidGludFwiLCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbXVsdGlwbHkgdGludCBhcHBsaWVkIHRvIHRoZSBNZXNoLiBUaGlzIGlzIGEgaGV4IHZhbHVlLiBBIHZhbHVlIG9mXG4gICAgICAgICAqIGAweEZGRkZGRmAgd2lsbCByZW1vdmUgYW55IHRpbnQgZWZmZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICAgICAqIEBkZWZhdWx0IDB4RkZGRkZGXG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNoYWRlci50aW50O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zaGFkZXIudGludCA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2gucHJvdG90eXBlLCBcInRleHR1cmVcIiwge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRleHR1cmUgdGhhdCB0aGUgTWVzaCB1c2VzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLlRleHR1cmV9XG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNoYWRlci50ZXh0dXJlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zaGFkZXIudGV4dHVyZSA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogU3RhbmRhcmQgcmVuZGVyZXIgZHJhdy5cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICogQHBhcmFtIHtQSVhJLlJlbmRlcmVyfSByZW5kZXJlciAtIEluc3RhbmNlIHRvIHJlbmRlcmVyLlxuICAgICAqL1xuICAgIE1lc2gucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbiAocmVuZGVyZXIpIHtcbiAgICAgICAgLy8gc2V0IHByb3BlcnRpZXMgZm9yIGJhdGNoaW5nLi5cbiAgICAgICAgLy8gVE9ETyBjb3VsZCB1c2UgYSBkaWZmZXJlbnQgd2F5IHRvIGdyYWIgdmVydHM/XG4gICAgICAgIHZhciB2ZXJ0aWNlcyA9IHRoaXMuZ2VvbWV0cnkuYnVmZmVyc1swXS5kYXRhO1xuICAgICAgICAvLyBUT0RPIGJlbmNobWFyayBjaGVjayBmb3IgYXR0cmlidXRlIHNpemUuLlxuICAgICAgICBpZiAodGhpcy5zaGFkZXIuYmF0Y2hhYmxlXG4gICAgICAgICAgICAmJiB0aGlzLmRyYXdNb2RlID09PSBEUkFXX01PREVTLlRSSUFOR0xFU1xuICAgICAgICAgICAgJiYgdmVydGljZXMubGVuZ3RoIDwgTWVzaC5CQVRDSEFCTEVfU0laRSAqIDIpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRvQmF0Y2gocmVuZGVyZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyRGVmYXVsdChyZW5kZXJlcik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFN0YW5kYXJkIG5vbi1iYXRjaGluZyB3YXkgb2YgcmVuZGVyaW5nLlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKiBAcGFyYW0ge1BJWEkuUmVuZGVyZXJ9IHJlbmRlcmVyIC0gSW5zdGFuY2UgdG8gcmVuZGVyZXIuXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuX3JlbmRlckRlZmF1bHQgPSBmdW5jdGlvbiAocmVuZGVyZXIpIHtcbiAgICAgICAgdmFyIHNoYWRlciA9IHRoaXMuc2hhZGVyO1xuICAgICAgICBzaGFkZXIuYWxwaGEgPSB0aGlzLndvcmxkQWxwaGE7XG4gICAgICAgIGlmIChzaGFkZXIudXBkYXRlKSB7XG4gICAgICAgICAgICBzaGFkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyZXIuYmF0Y2guZmx1c2goKTtcbiAgICAgICAgaWYgKHNoYWRlci5wcm9ncmFtLnVuaWZvcm1EYXRhLnRyYW5zbGF0aW9uTWF0cml4KSB7XG4gICAgICAgICAgICBzaGFkZXIudW5pZm9ybXMudHJhbnNsYXRpb25NYXRyaXggPSB0aGlzLnRyYW5zZm9ybS53b3JsZFRyYW5zZm9ybS50b0FycmF5KHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGJpbmQgYW5kIHN5bmMgdW5pZm9ybXMuLlxuICAgICAgICByZW5kZXJlci5zaGFkZXIuYmluZChzaGFkZXIpO1xuICAgICAgICAvLyBzZXQgc3RhdGUuLlxuICAgICAgICByZW5kZXJlci5zdGF0ZS5zZXQodGhpcy5zdGF0ZSk7XG4gICAgICAgIC8vIGJpbmQgdGhlIGdlb21ldHJ5Li4uXG4gICAgICAgIHJlbmRlcmVyLmdlb21ldHJ5LmJpbmQodGhpcy5nZW9tZXRyeSwgc2hhZGVyKTtcbiAgICAgICAgLy8gdGhlbiByZW5kZXIgaXRcbiAgICAgICAgcmVuZGVyZXIuZ2VvbWV0cnkuZHJhdyh0aGlzLmRyYXdNb2RlLCB0aGlzLnNpemUsIHRoaXMuc3RhcnQsIHRoaXMuZ2VvbWV0cnkuaW5zdGFuY2VDb3VudCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZW5kZXJpbmcgYnkgdXNpbmcgdGhlIEJhdGNoIHN5c3RlbS5cbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICogQHBhcmFtIHtQSVhJLlJlbmRlcmVyfSByZW5kZXJlciAtIEluc3RhbmNlIHRvIHJlbmRlcmVyLlxuICAgICAqL1xuICAgIE1lc2gucHJvdG90eXBlLl9yZW5kZXJUb0JhdGNoID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7XG4gICAgICAgIGlmICh0aGlzLnNoYWRlci51dk1hdHJpeCkge1xuICAgICAgICAgICAgdGhpcy5zaGFkZXIudXZNYXRyaXgudXBkYXRlKCk7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVV2cygpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHNldCBwcm9wZXJ0aWVzIGZvciBiYXRjaGluZy4uXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlVmVydGljZXMoKTtcbiAgICAgICAgdGhpcy5pbmRpY2VzID0gZ2VvbWV0cnkuaW5kZXhCdWZmZXIuZGF0YTtcbiAgICAgICAgdGhpcy5fdGludFJHQiA9IHRoaXMuc2hhZGVyLl90aW50UkdCO1xuICAgICAgICB0aGlzLl90ZXh0dXJlID0gdGhpcy5zaGFkZXIudGV4dHVyZTtcbiAgICAgICAgdmFyIHBsdWdpbk5hbWUgPSB0aGlzLm1hdGVyaWFsLnBsdWdpbk5hbWU7XG4gICAgICAgIHJlbmRlcmVyLmJhdGNoLnNldE9iamVjdFJlbmRlcmVyKHJlbmRlcmVyLnBsdWdpbnNbcGx1Z2luTmFtZV0pO1xuICAgICAgICByZW5kZXJlci5wbHVnaW5zW3BsdWdpbk5hbWVdLnJlbmRlcih0aGlzKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdmVydGV4RGF0YSBmaWVsZCBiYXNlZCBvbiB0cmFuc2Zvcm0gYW5kIHZlcnRpY2VzXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuY2FsY3VsYXRlVmVydGljZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7XG4gICAgICAgIHZhciB2ZXJ0aWNlcyA9IGdlb21ldHJ5LmJ1ZmZlcnNbMF0uZGF0YTtcbiAgICAgICAgaWYgKGdlb21ldHJ5LnZlcnRleERpcnR5SWQgPT09IHRoaXMudmVydGV4RGlydHkgJiYgdGhpcy5fdHJhbnNmb3JtSUQgPT09IHRoaXMudHJhbnNmb3JtLl93b3JsZElEKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdHJhbnNmb3JtSUQgPSB0aGlzLnRyYW5zZm9ybS5fd29ybGRJRDtcbiAgICAgICAgaWYgKHRoaXMudmVydGV4RGF0YS5sZW5ndGggIT09IHZlcnRpY2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy52ZXJ0ZXhEYXRhID0gbmV3IEZsb2F0MzJBcnJheSh2ZXJ0aWNlcy5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciB3dCA9IHRoaXMudHJhbnNmb3JtLndvcmxkVHJhbnNmb3JtO1xuICAgICAgICB2YXIgYSA9IHd0LmE7XG4gICAgICAgIHZhciBiID0gd3QuYjtcbiAgICAgICAgdmFyIGMgPSB3dC5jO1xuICAgICAgICB2YXIgZCA9IHd0LmQ7XG4gICAgICAgIHZhciB0eCA9IHd0LnR4O1xuICAgICAgICB2YXIgdHkgPSB3dC50eTtcbiAgICAgICAgdmFyIHZlcnRleERhdGEgPSB0aGlzLnZlcnRleERhdGE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVydGV4RGF0YS5sZW5ndGggLyAyOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB4ID0gdmVydGljZXNbKGkgKiAyKV07XG4gICAgICAgICAgICB2YXIgeSA9IHZlcnRpY2VzWyhpICogMikgKyAxXTtcbiAgICAgICAgICAgIHZlcnRleERhdGFbKGkgKiAyKV0gPSAoYSAqIHgpICsgKGMgKiB5KSArIHR4O1xuICAgICAgICAgICAgdmVydGV4RGF0YVsoaSAqIDIpICsgMV0gPSAoYiAqIHgpICsgKGQgKiB5KSArIHR5O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9yb3VuZFBpeGVscykge1xuICAgICAgICAgICAgdmFyIHJlc29sdXRpb24gPSBzZXR0aW5ncy5SRVNPTFVUSU9OO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJ0ZXhEYXRhLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdmVydGV4RGF0YVtpXSA9IE1hdGgucm91bmQoKHZlcnRleERhdGFbaV0gKiByZXNvbHV0aW9uIHwgMCkgLyByZXNvbHV0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnZlcnRleERpcnR5ID0gZ2VvbWV0cnkudmVydGV4RGlydHlJZDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdXYgZmllbGQgYmFzZWQgb24gZnJvbSBnZW9tZXRyeSB1didzIG9yIGJhdGNoVXZzXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuY2FsY3VsYXRlVXZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZ2VvbVV2cyA9IHRoaXMuZ2VvbWV0cnkuYnVmZmVyc1sxXTtcbiAgICAgICAgaWYgKCF0aGlzLnNoYWRlci51dk1hdHJpeC5pc1NpbXBsZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmJhdGNoVXZzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iYXRjaFV2cyA9IG5ldyBNZXNoQmF0Y2hVdnMoZ2VvbVV2cywgdGhpcy5zaGFkZXIudXZNYXRyaXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5iYXRjaFV2cy51cGRhdGUoKTtcbiAgICAgICAgICAgIHRoaXMudXZzID0gdGhpcy5iYXRjaFV2cy5kYXRhO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51dnMgPSBnZW9tVXZzLmRhdGE7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIGJvdW5kcyBvZiB0aGUgbWVzaCBhcyBhIHJlY3RhbmdsZS4gVGhlIGJvdW5kcyBjYWxjdWxhdGlvbiB0YWtlcyB0aGUgd29ybGRUcmFuc2Zvcm0gaW50byBhY2NvdW50LlxuICAgICAqIHRoZXJlIG11c3QgYmUgYSBhVmVydGV4UG9zaXRpb24gYXR0cmlidXRlIHByZXNlbnQgaW4gdGhlIGdlb21ldHJ5IGZvciBib3VuZHMgdG8gYmUgY2FsY3VsYXRlZCBjb3JyZWN0bHkuXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuX2NhbGN1bGF0ZUJvdW5kcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVWZXJ0aWNlcygpO1xuICAgICAgICB0aGlzLl9ib3VuZHMuYWRkVmVydGV4RGF0YSh0aGlzLnZlcnRleERhdGEsIDAsIHRoaXMudmVydGV4RGF0YS5sZW5ndGgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogVGVzdHMgaWYgYSBwb2ludCBpcyBpbnNpZGUgdGhpcyBtZXNoLiBXb3JrcyBvbmx5IGZvciBQSVhJLkRSQVdfTU9ERVMuVFJJQU5HTEVTLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtQSVhJLklQb2ludERhdGF9IHBvaW50IC0gdGhlIHBvaW50IHRvIHRlc3RcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB0aGUgcmVzdWx0IG9mIHRoZSB0ZXN0XG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuY29udGFpbnNQb2ludCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICBpZiAoIXRoaXMuZ2V0Qm91bmRzKCkuY29udGFpbnMocG9pbnQueCwgcG9pbnQueSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndvcmxkVHJhbnNmb3JtLmFwcGx5SW52ZXJzZShwb2ludCwgdGVtcFBvaW50KTtcbiAgICAgICAgdmFyIHZlcnRpY2VzID0gdGhpcy5nZW9tZXRyeS5nZXRCdWZmZXIoJ2FWZXJ0ZXhQb3NpdGlvbicpLmRhdGE7XG4gICAgICAgIHZhciBwb2ludHMgPSB0ZW1wUG9seWdvbi5wb2ludHM7XG4gICAgICAgIHZhciBpbmRpY2VzID0gdGhpcy5nZW9tZXRyeS5nZXRJbmRleCgpLmRhdGE7XG4gICAgICAgIHZhciBsZW4gPSBpbmRpY2VzLmxlbmd0aDtcbiAgICAgICAgdmFyIHN0ZXAgPSB0aGlzLmRyYXdNb2RlID09PSA0ID8gMyA6IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpICsgMiA8IGxlbjsgaSArPSBzdGVwKSB7XG4gICAgICAgICAgICB2YXIgaW5kMCA9IGluZGljZXNbaV0gKiAyO1xuICAgICAgICAgICAgdmFyIGluZDEgPSBpbmRpY2VzW2kgKyAxXSAqIDI7XG4gICAgICAgICAgICB2YXIgaW5kMiA9IGluZGljZXNbaSArIDJdICogMjtcbiAgICAgICAgICAgIHBvaW50c1swXSA9IHZlcnRpY2VzW2luZDBdO1xuICAgICAgICAgICAgcG9pbnRzWzFdID0gdmVydGljZXNbaW5kMCArIDFdO1xuICAgICAgICAgICAgcG9pbnRzWzJdID0gdmVydGljZXNbaW5kMV07XG4gICAgICAgICAgICBwb2ludHNbM10gPSB2ZXJ0aWNlc1tpbmQxICsgMV07XG4gICAgICAgICAgICBwb2ludHNbNF0gPSB2ZXJ0aWNlc1tpbmQyXTtcbiAgICAgICAgICAgIHBvaW50c1s1XSA9IHZlcnRpY2VzW2luZDIgKyAxXTtcbiAgICAgICAgICAgIGlmICh0ZW1wUG9seWdvbi5jb250YWlucyh0ZW1wUG9pbnQueCwgdGVtcFBvaW50LnkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogRGVzdHJveXMgdGhlIE1lc2ggb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R8Ym9vbGVhbn0gW29wdGlvbnNdIC0gT3B0aW9ucyBwYXJhbWV0ZXIuIEEgYm9vbGVhbiB3aWxsIGFjdCBhcyBpZiBhbGxcbiAgICAgKiAgb3B0aW9ucyBoYXZlIGJlZW4gc2V0IHRvIHRoYXQgdmFsdWVcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmNoaWxkcmVuPWZhbHNlXSAtIGlmIHNldCB0byB0cnVlLCBhbGwgdGhlIGNoaWxkcmVuIHdpbGwgaGF2ZVxuICAgICAqICB0aGVpciBkZXN0cm95IG1ldGhvZCBjYWxsZWQgYXMgd2VsbC4gJ29wdGlvbnMnIHdpbGwgYmUgcGFzc2VkIG9uIHRvIHRob3NlIGNhbGxzLlxuICAgICAqL1xuICAgIE1lc2gucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5nZW9tZXRyeS5yZWZDb3VudC0tO1xuICAgICAgICBpZiAodGhpcy5nZW9tZXRyeS5yZWZDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5nZW9tZXRyeSA9IG51bGw7XG4gICAgICAgIHRoaXMuc2hhZGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IG51bGw7XG4gICAgICAgIHRoaXMudXZzID0gbnVsbDtcbiAgICAgICAgdGhpcy5pbmRpY2VzID0gbnVsbDtcbiAgICAgICAgdGhpcy52ZXJ0ZXhEYXRhID0gbnVsbDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB2ZXJ0aWNlcyB0byBjb25zaWRlciBiYXRjaGFibGUuIEdlbmVyYWxseSwgdGhlIGNvbXBsZXhpdHlcbiAgICAgKiBvZiB0aGUgZ2VvbWV0cnkuXG4gICAgICogQG1lbWJlcm9mIFBJWEkuTWVzaFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAbWVtYmVyIHtudW1iZXJ9IEJBVENIQUJMRV9TSVpFXG4gICAgICovXG4gICAgTWVzaC5CQVRDSEFCTEVfU0laRSA9IDEwMDtcbiAgICByZXR1cm4gTWVzaDtcbn0oQ29udGFpbmVyKSk7XG5cbnZhciBmcmFnbWVudCA9IFwidmFyeWluZyB2ZWMyIHZUZXh0dXJlQ29vcmQ7XFxudW5pZm9ybSB2ZWM0IHVDb2xvcjtcXG5cXG51bmlmb3JtIHNhbXBsZXIyRCB1U2FtcGxlcjtcXG5cXG52b2lkIG1haW4odm9pZClcXG57XFxuICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleHR1cmVDb29yZCkgKiB1Q29sb3I7XFxufVxcblwiO1xuXG52YXIgdmVydGV4ID0gXCJhdHRyaWJ1dGUgdmVjMiBhVmVydGV4UG9zaXRpb247XFxuYXR0cmlidXRlIHZlYzIgYVRleHR1cmVDb29yZDtcXG5cXG51bmlmb3JtIG1hdDMgcHJvamVjdGlvbk1hdHJpeDtcXG51bmlmb3JtIG1hdDMgdHJhbnNsYXRpb25NYXRyaXg7XFxudW5pZm9ybSBtYXQzIHVUZXh0dXJlTWF0cml4O1xcblxcbnZhcnlpbmcgdmVjMiB2VGV4dHVyZUNvb3JkO1xcblxcbnZvaWQgbWFpbih2b2lkKVxcbntcXG4gICAgZ2xfUG9zaXRpb24gPSB2ZWM0KChwcm9qZWN0aW9uTWF0cml4ICogdHJhbnNsYXRpb25NYXRyaXggKiB2ZWMzKGFWZXJ0ZXhQb3NpdGlvbiwgMS4wKSkueHksIDAuMCwgMS4wKTtcXG5cXG4gICAgdlRleHR1cmVDb29yZCA9ICh1VGV4dHVyZU1hdHJpeCAqIHZlYzMoYVRleHR1cmVDb29yZCwgMS4wKSkueHk7XFxufVxcblwiO1xuXG4vKipcbiAqIFNsaWdodGx5IG9waW5pb25hdGVkIGRlZmF1bHQgc2hhZGVyIGZvciBQaXhpSlMgMkQgb2JqZWN0cy5cbiAqIEBjbGFzc1xuICogQG1lbWJlcm9mIFBJWElcbiAqIEBleHRlbmRzIFBJWEkuU2hhZGVyXG4gKi9cbnZhciBNZXNoTWF0ZXJpYWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1lc2hNYXRlcmlhbCwgX3N1cGVyKTtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1BJWEkuVGV4dHVyZX0gdVNhbXBsZXIgLSBUZXh0dXJlIHRoYXQgbWF0ZXJpYWwgdXNlcyB0byByZW5kZXIuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIEFkZGl0aW9uYWwgb3B0aW9uc1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5hbHBoYT0xXSAtIERlZmF1bHQgYWxwaGEuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnRpbnQ9MHhGRkZGRkZdIC0gRGVmYXVsdCB0aW50LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5wbHVnaW5OYW1lPSdiYXRjaCddIC0gUmVuZGVyZXIgcGx1Z2luIGZvciBiYXRjaGluZy5cbiAgICAgKiBAcGFyYW0ge1BJWEkuUHJvZ3JhbX0gW29wdGlvbnMucHJvZ3JhbT0weEZGRkZGRl0gLSBDdXN0b20gcHJvZ3JhbS5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnMudW5pZm9ybXNdIC0gQ3VzdG9tIHVuaWZvcm1zLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE1lc2hNYXRlcmlhbCh1U2FtcGxlciwgb3B0aW9ucykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgdW5pZm9ybXMgPSB7XG4gICAgICAgICAgICB1U2FtcGxlcjogdVNhbXBsZXIsXG4gICAgICAgICAgICBhbHBoYTogMSxcbiAgICAgICAgICAgIHVUZXh0dXJlTWF0cml4OiBNYXRyaXguSURFTlRJVFksXG4gICAgICAgICAgICB1Q29sb3I6IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDEsIDFdKSxcbiAgICAgICAgfTtcbiAgICAgICAgLy8gU2V0IGRlZmF1bHRzXG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgIHRpbnQ6IDB4RkZGRkZGLFxuICAgICAgICAgICAgYWxwaGE6IDEsXG4gICAgICAgICAgICBwbHVnaW5OYW1lOiAnYmF0Y2gnLFxuICAgICAgICB9LCBvcHRpb25zKTtcbiAgICAgICAgaWYgKG9wdGlvbnMudW5pZm9ybXMpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odW5pZm9ybXMsIG9wdGlvbnMudW5pZm9ybXMpO1xuICAgICAgICB9XG4gICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgb3B0aW9ucy5wcm9ncmFtIHx8IFByb2dyYW0uZnJvbSh2ZXJ0ZXgsIGZyYWdtZW50KSwgdW5pZm9ybXMpIHx8IHRoaXM7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPbmx5IGRvIHVwZGF0ZSBpZiB0aW50IG9yIGFscGhhIGNoYW5nZXMuXG4gICAgICAgICAqIEBtZW1iZXIge2Jvb2xlYW59XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5fY29sb3JEaXJ0eSA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGV4dHVyZU1hdHJpeCBpbnN0YW5jZSBmb3IgdGhpcyBNZXNoLCB1c2VkIHRvIHRyYWNrIFRleHR1cmUgY2hhbmdlc1xuICAgICAgICAgKlxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLlRleHR1cmVNYXRyaXh9XG4gICAgICAgICAqIEByZWFkb25seVxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMudXZNYXRyaXggPSBuZXcgVGV4dHVyZU1hdHJpeCh1U2FtcGxlcik7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBgdHJ1ZWAgaWYgc2hhZGVyIGNhbiBiZSBiYXRjaCB3aXRoIHRoZSByZW5kZXJlcidzIGJhdGNoIHN5c3RlbS5cbiAgICAgICAgICogQG1lbWJlciB7Ym9vbGVhbn1cbiAgICAgICAgICogQGRlZmF1bHQgdHJ1ZVxuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMuYmF0Y2hhYmxlID0gb3B0aW9ucy5wcm9ncmFtID09PSB1bmRlZmluZWQ7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW5kZXJlciBwbHVnaW4gZm9yIGJhdGNoaW5nXG4gICAgICAgICAqXG4gICAgICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgICAgICogQGRlZmF1bHQgJ2JhdGNoJ1xuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMucGx1Z2luTmFtZSA9IG9wdGlvbnMucGx1Z2luTmFtZTtcbiAgICAgICAgX3RoaXMudGludCA9IG9wdGlvbnMudGludDtcbiAgICAgICAgX3RoaXMuYWxwaGEgPSBvcHRpb25zLmFscGhhO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoTWF0ZXJpYWwucHJvdG90eXBlLCBcInRleHR1cmVcIiwge1xuICAgICAgICAvKipcbiAgICAgICAgICogUmVmZXJlbmNlIHRvIHRoZSB0ZXh0dXJlIGJlaW5nIHJlbmRlcmVkLlxuICAgICAgICAgKiBAbWVtYmVyIHtQSVhJLlRleHR1cmV9XG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVuaWZvcm1zLnVTYW1wbGVyO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMudW5pZm9ybXMudVNhbXBsZXIgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51bmlmb3Jtcy51U2FtcGxlciA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHRoaXMudXZNYXRyaXgudGV4dHVyZSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2hNYXRlcmlhbC5wcm90b3R5cGUsIFwiYWxwaGFcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbHBoYTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgZ2V0cyBhdXRvbWF0aWNhbGx5IHNldCBieSB0aGUgb2JqZWN0IHVzaW5nIHRoaXMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBkZWZhdWx0IDFcbiAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdGhpcy5fYWxwaGEpXG4gICAgICAgICAgICAgICAgeyByZXR1cm47IH1cbiAgICAgICAgICAgIHRoaXMuX2FscGhhID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLl9jb2xvckRpcnR5ID0gdHJ1ZTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoTWF0ZXJpYWwucHJvdG90eXBlLCBcInRpbnRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW50O1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogTXVsdGlwbHkgdGludCBmb3IgdGhlIG1hdGVyaWFsLlxuICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICAgICAqIEBkZWZhdWx0IDB4RkZGRkZGXG4gICAgICAgICAqL1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0aGlzLl90aW50KVxuICAgICAgICAgICAgICAgIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICB0aGlzLl90aW50ID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLl90aW50UkdCID0gKHZhbHVlID4+IDE2KSArICh2YWx1ZSAmIDB4ZmYwMCkgKyAoKHZhbHVlICYgMHhmZikgPDwgMTYpO1xuICAgICAgICAgICAgdGhpcy5fY29sb3JEaXJ0eSA9IHRydWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICAvKipcbiAgICAgKiBHZXRzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBNZXNoLiBJbnRlbmRlZCB0byBiZSBvdmVycmlkZGVuIGZvciBjdXN0b21cbiAgICAgKiBNZXNoTWF0ZXJpYWwgb2JqZWN0cy5cbiAgICAgKi9cbiAgICBNZXNoTWF0ZXJpYWwucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NvbG9yRGlydHkpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbG9yRGlydHkgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBiYXNlVGV4dHVyZSA9IHRoaXMudGV4dHVyZS5iYXNlVGV4dHVyZTtcbiAgICAgICAgICAgIHByZW11bHRpcGx5VGludFRvUmdiYSh0aGlzLl90aW50LCB0aGlzLl9hbHBoYSwgdGhpcy51bmlmb3Jtcy51Q29sb3IsIGJhc2VUZXh0dXJlLmFscGhhTW9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudXZNYXRyaXgudXBkYXRlKCkpIHtcbiAgICAgICAgICAgIHRoaXMudW5pZm9ybXMudVRleHR1cmVNYXRyaXggPSB0aGlzLnV2TWF0cml4Lm1hcENvb3JkO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gTWVzaE1hdGVyaWFsO1xufShTaGFkZXIpKTtcblxuLyoqXG4gKiBTdGFuZGFyZCAyRCBnZW9tZXRyeSB1c2VkIGluIFBpeGlKUy5cbiAqXG4gKiBHZW9tZXRyeSBjYW4gYmUgZGVmaW5lZCB3aXRob3V0IHBhc3NpbmcgaW4gYSBzdHlsZSBvciBkYXRhIGlmIHJlcXVpcmVkLlxuICpcbiAqIGBgYGpzXG4gKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBQSVhJLkdlb21ldHJ5KCk7XG4gKlxuICogZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCdwb3NpdGlvbnMnLCBbMCwgMCwgMTAwLCAwLCAxMDAsIDEwMCwgMCwgMTAwXSwgMik7XG4gKiBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoJ3V2cycsIFswLDAsMSwwLDEsMSwwLDFdLCAyKTtcbiAqIGdlb21ldHJ5LmFkZEluZGV4KFswLDEsMiwxLDMsMl0pO1xuICpcbiAqIGBgYFxuICogQGNsYXNzXG4gKiBAbWVtYmVyb2YgUElYSVxuICogQGV4dGVuZHMgUElYSS5HZW9tZXRyeVxuICovXG52YXIgTWVzaEdlb21ldHJ5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNZXNoR2VvbWV0cnksIF9zdXBlcik7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtGbG9hdDMyQXJyYXl8bnVtYmVyW119IFt2ZXJ0aWNlc10gLSBQb3NpdGlvbmFsIGRhdGEgb24gZ2VvbWV0cnkuXG4gICAgICogQHBhcmFtIHtGbG9hdDMyQXJyYXl8bnVtYmVyW119IFt1dnNdIC0gVGV4dHVyZSBVVnMuXG4gICAgICogQHBhcmFtIHtVaW50MTZBcnJheXxudW1iZXJbXX0gW2luZGV4XSAtIEluZGV4QnVmZmVyXG4gICAgICovXG4gICAgZnVuY3Rpb24gTWVzaEdlb21ldHJ5KHZlcnRpY2VzLCB1dnMsIGluZGV4KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIHZhciB2ZXJ0aWNlc0J1ZmZlciA9IG5ldyBCdWZmZXIodmVydGljZXMpO1xuICAgICAgICB2YXIgdXZzQnVmZmVyID0gbmV3IEJ1ZmZlcih1dnMsIHRydWUpO1xuICAgICAgICB2YXIgaW5kZXhCdWZmZXIgPSBuZXcgQnVmZmVyKGluZGV4LCB0cnVlLCB0cnVlKTtcbiAgICAgICAgX3RoaXMuYWRkQXR0cmlidXRlKCdhVmVydGV4UG9zaXRpb24nLCB2ZXJ0aWNlc0J1ZmZlciwgMiwgZmFsc2UsIFRZUEVTLkZMT0FUKVxuICAgICAgICAgICAgLmFkZEF0dHJpYnV0ZSgnYVRleHR1cmVDb29yZCcsIHV2c0J1ZmZlciwgMiwgZmFsc2UsIFRZUEVTLkZMT0FUKVxuICAgICAgICAgICAgLmFkZEluZGV4KGluZGV4QnVmZmVyKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpcnR5IGZsYWcgdG8gbGltaXQgdXBkYXRlIGNhbGxzIG9uIE1lc2guIEZvciBleGFtcGxlLFxuICAgICAgICAgKiBsaW1pdGluZyB1cGRhdGVzIG9uIGEgc2luZ2xlIE1lc2ggaW5zdGFuY2Ugd2l0aCBhIHNoYXJlZCBHZW9tZXRyeVxuICAgICAgICAgKiB3aXRoaW4gdGhlIHJlbmRlciBsb29wLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAbWVtYmVyIHtudW1iZXJ9XG4gICAgICAgICAqIEBkZWZhdWx0IC0xXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5fdXBkYXRlSWQgPSAtMTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaEdlb21ldHJ5LnByb3RvdHlwZSwgXCJ2ZXJ0ZXhEaXJ0eUlkXCIsIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIHRoZSB2ZXJ0ZXggcG9zaXRpb24gaXMgdXBkYXRlZC5cbiAgICAgICAgICogQG1lbWJlciB7bnVtYmVyfVxuICAgICAgICAgKiBAcmVhZG9ubHlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyc1swXS5fdXBkYXRlSUQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gTWVzaEdlb21ldHJ5O1xufShHZW9tZXRyeSkpO1xuXG5leHBvcnQgeyBNZXNoLCBNZXNoQmF0Y2hVdnMsIE1lc2hHZW9tZXRyeSwgTWVzaE1hdGVyaWFsIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZXNoLmVzLmpzLm1hcFxuIl0sIm5hbWVzIjpbImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwiaGFzT3duUHJvcGVydHkiLCJfX2V4dGVuZHMiLCJfXyIsInRoaXMiLCJjb25zdHJ1Y3RvciIsInByb3RvdHlwZSIsImNyZWF0ZSIsIk1lc2hCYXRjaFV2cyIsInV2QnVmZmVyIiwidXZNYXRyaXgiLCJkYXRhIiwiX2J1ZmZlclVwZGF0ZUlkIiwiX3RleHR1cmVVcGRhdGVJZCIsIl91cGRhdGVJRCIsInVwZGF0ZSIsImZvcmNlVXBkYXRlIiwibGVuZ3RoIiwiRmxvYXQzMkFycmF5IiwibXVsdGlwbHlVdnMiLCJ0ZW1wUG9pbnQiLCJ0ZW1wUG9seWdvbiIsIk1lc2giLCJfc3VwZXIiLCJnZW9tZXRyeSIsInNoYWRlciIsInN0YXRlIiwiZHJhd01vZGUiLCJfdGhpcyIsImNhbGwiLCJyZWZDb3VudCIsInN0YXJ0Iiwic2l6ZSIsInV2cyIsImluZGljZXMiLCJ2ZXJ0ZXhEYXRhIiwidmVydGV4RGlydHkiLCJfdHJhbnNmb3JtSUQiLCJfcm91bmRQaXhlbHMiLCJiYXRjaFV2cyIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiYnVmZmVycyIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJzZXQiLCJ2YWx1ZSIsImJsZW5kTW9kZSIsInRpbnQiLCJ0ZXh0dXJlIiwiX3JlbmRlciIsInJlbmRlcmVyIiwidmVydGljZXMiLCJiYXRjaGFibGUiLCJCQVRDSEFCTEVfU0laRSIsIl9yZW5kZXJUb0JhdGNoIiwiX3JlbmRlckRlZmF1bHQiLCJhbHBoYSIsIndvcmxkQWxwaGEiLCJiYXRjaCIsImZsdXNoIiwicHJvZ3JhbSIsInVuaWZvcm1EYXRhIiwidHJhbnNsYXRpb25NYXRyaXgiLCJ1bmlmb3JtcyIsInRyYW5zZm9ybSIsIndvcmxkVHJhbnNmb3JtIiwidG9BcnJheSIsImJpbmQiLCJkcmF3IiwiaW5zdGFuY2VDb3VudCIsImNhbGN1bGF0ZVV2cyIsImNhbGN1bGF0ZVZlcnRpY2VzIiwiaW5kZXhCdWZmZXIiLCJfdGludFJHQiIsIl90ZXh0dXJlIiwicGx1Z2luTmFtZSIsIm1hdGVyaWFsIiwic2V0T2JqZWN0UmVuZGVyZXIiLCJwbHVnaW5zIiwicmVuZGVyIiwidmVydGV4RGlydHlJZCIsIl93b3JsZElEIiwid3QiLCJhIiwiYyIsInR4IiwidHkiLCJpIiwieCIsInkiLCJyZXNvbHV0aW9uIiwiTWF0aCIsInJvdW5kIiwiZ2VvbVV2cyIsImlzU2ltcGxlIiwiX2NhbGN1bGF0ZUJvdW5kcyIsIl9ib3VuZHMiLCJhZGRWZXJ0ZXhEYXRhIiwiY29udGFpbnNQb2ludCIsInBvaW50IiwiZ2V0Qm91bmRzIiwiY29udGFpbnMiLCJhcHBseUludmVyc2UiLCJnZXRCdWZmZXIiLCJwb2ludHMiLCJnZXRJbmRleCIsImxlbiIsInN0ZXAiLCJpbmQwIiwiaW5kMSIsImluZDIiLCJkZXN0cm95Iiwib3B0aW9ucyIsImRpc3Bvc2UiLCJNZXNoTWF0ZXJpYWwiLCJ1U2FtcGxlciIsInVUZXh0dXJlTWF0cml4IiwidUNvbG9yIiwiYXNzaWduIiwiX2NvbG9yRGlydHkiLCJ1bmRlZmluZWQiLCJfYWxwaGEiLCJfdGludCIsImJhc2VUZXh0dXJlIiwicHJlbXVsdGlwbHlUaW50VG9SZ2JhIiwiYWxwaGFNb2RlIiwibWFwQ29vcmQiLCJNZXNoR2VvbWV0cnkiLCJpbmRleCIsInZlcnRpY2VzQnVmZmVyIiwidXZzQnVmZmVyIiwiYWRkQXR0cmlidXRlIiwiYWRkSW5kZXgiLCJfdXBkYXRlSWQiXSwic291cmNlUm9vdCI6IiJ9