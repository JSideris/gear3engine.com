/*! For license information please see 414.afc733181d1f195513cc.js.LICENSE.txt */
"use strict";(self.webpackChunkgear3engine_website=self.webpackChunkgear3engine_website||[]).push([[414],{414:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});var i=r(2514),n=r(932),a=r(5868),o=r(3663),s=r(19),u=r(8950),h=function(t,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},h(t,e)};function l(t,e){function r(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var f=function(){function t(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return t.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},t}(),d=new n.Point,c=new n.Polygon,p=function(t){function e(e,r,n,o){void 0===o&&(o=a.DRAW_MODES.TRIANGLES);var u=t.call(this)||this;return u.geometry=e,u.shader=r,u.state=n||i.State.for2d(),u.drawMode=o,u.start=0,u.size=0,u.uvs=null,u.indices=null,u.vertexData=new Float32Array(1),u.vertexDirty=-1,u._transformID=-1,u._roundPixels=s.settings.ROUND_PIXELS,u.batchUvs=null,u}return l(e,t),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===a.DRAW_MODES.TRIANGLES&&r.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var i=this.transform.worldTransform,n=i.a,a=i.b,o=i.c,u=i.d,h=i.tx,l=i.ty,f=this.vertexData,d=0;d<f.length/2;d++){var c=e[2*d],p=e[2*d+1];f[2*d]=n*c+o*p+h,f[2*d+1]=a*c+u*p+l}if(this._roundPixels){var y=s.settings.RESOLUTION;for(d=0;d<f.length;++d)f[d]=Math.round((f[d]*y|0)/y)}this.vertexDirty=r}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new f(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,d);for(var e=this.geometry.getBuffer("aVertexPosition").data,r=c.points,i=this.geometry.getIndex().data,n=i.length,a=4===this.drawMode?3:1,o=0;o+2<n;o+=a){var s=2*i[o],u=2*i[o+1],h=2*i[o+2];if(r[0]=e[s],r[1]=e[s+1],r[2]=e[u],r[3]=e[u+1],r[4]=e[h],r[5]=e[h+1],c.contains(d.x,d.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e}(o.Container),y=function(t){function e(e,r){var a=this,o={uSampler:e,alpha:1,uTextureMatrix:n.Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(o,r.uniforms),(a=t.call(this,r.program||i.Program.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),o)||this)._colorDirty=!1,a.uvMatrix=new i.TextureMatrix(e),a.batchable=void 0===r.program,a.pluginName=r.pluginName,a.tint=r.tint,a.alpha=r.alpha,a}return l(e,t),Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;u.premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e}(i.Shader),m=function(t){function e(e,r,n){var o=t.call(this)||this,s=new i.Buffer(e),u=new i.Buffer(r,!0),h=new i.Buffer(n,!0,!0);return o.addAttribute("aVertexPosition",s,2,!1,a.TYPES.FLOAT).addAttribute("aTextureCoord",u,2,!1,a.TYPES.FLOAT).addIndex(h),o._updateId=-1,o}return l(e,t),Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e}(i.Geometry);e.Mesh=p,e.MeshBatchUvs=f,e.MeshGeometry=m,e.MeshMaterial=y}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SixNQUFNQyxPQUMzRUYsYUFBYSxnQkFBaUJELEVBQVcsR0FBRyxFQUFPNUosRUFBVThKLE1BQU1DLE9BQ25FQyxTQUFTeEUsR0FDZDlDLEVBQU11SCxXQUFhLEVBQ1p2SCxDQUNYLENBYUEsT0E3QkE5QixFQUFVNkksRUFBY3RILEdBaUJ4QnpDLE9BQU9DLGVBQWU4SixFQUFhekksVUFBVyxnQkFBaUIsQ0FNM0R3QyxJQUFLLFdBQ0QsT0FBTzFDLEtBQUtpRCxRQUFRLEdBQUd2QyxTQUMzQixFQUNBcUMsWUFBWSxFQUNaQyxjQUFjLElBRVgyRixDQUNYLENBL0JpQyxDQStCL0IzSixFQUFLb0ssVUFFUHRLLEVBQVFzQyxLQUFPQSxFQUNmdEMsRUFBUXNCLGFBQWVBLEVBQ3ZCdEIsRUFBUTZKLGFBQWVBLEVBQ3ZCN0osRUFBUXlJLGFBQWVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ2VhcjNlbmdpbmUtd2Vic2l0ZS8uLi8uLi9HQU1FUy1TSU1VTEFUT1JTLUZVTi9nZWFyM2VuZ2luZS9wbHVnaW5zL2czZS1jYW52YXMtMmQvbm9kZV9tb2R1bGVzL0BwaXhpL21lc2gvZGlzdC9janMvbWVzaC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBwaXhpL21lc2ggLSB2Ni40LjJcbiAqIENvbXBpbGVkIFRodSwgMDIgSnVuIDIwMjIgMTU6Mzk6MjYgVVRDXG4gKlxuICogQHBpeGkvbWVzaCBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4gKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcblxudmFyIGNvcmUgPSByZXF1aXJlKCdAcGl4aS9jb3JlJyk7XG52YXIgbWF0aCA9IHJlcXVpcmUoJ0BwaXhpL21hdGgnKTtcbnZhciBjb25zdGFudHMgPSByZXF1aXJlKCdAcGl4aS9jb25zdGFudHMnKTtcbnZhciBkaXNwbGF5ID0gcmVxdWlyZSgnQHBpeGkvZGlzcGxheScpO1xudmFyIHNldHRpbmdzID0gcmVxdWlyZSgnQHBpeGkvc2V0dGluZ3MnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJ0BwaXhpL3V0aWxzJyk7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXHJcbnRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXHJcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5USElTIENPREUgSVMgUFJPVklERUQgT04gQU4gKkFTIElTKiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXHJcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcclxuV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSxcclxuTUVSQ0hBTlRBQkxJVFkgT1IgTk9OLUlORlJJTkdFTUVOVC5cclxuXHJcblNlZSB0aGUgQXBhY2hlIFZlcnNpb24gMi4wIExpY2Vuc2UgZm9yIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xyXG5hbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0gfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxuXG4vKipcbiAqIENsYXNzIGNvbnRyb2xzIGNhY2hlIGZvciBVViBtYXBwaW5nIGZyb20gVGV4dHVyZSBub3JtYWwgc3BhY2UgdG8gQmFzZVRleHR1cmUgbm9ybWFsIHNwYWNlLlxuICogQG1lbWJlcm9mIFBJWElcbiAqL1xudmFyIE1lc2hCYXRjaFV2cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdXZCdWZmZXIgLSBCdWZmZXIgd2l0aCBub3JtYWxpemVkIHV2J3NcbiAgICAgKiBAcGFyYW0gdXZNYXRyaXggLSBNYXRlcmlhbCBVViBtYXRyaXhcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBNZXNoQmF0Y2hVdnModXZCdWZmZXIsIHV2TWF0cml4KSB7XG4gICAgICAgIHRoaXMudXZCdWZmZXIgPSB1dkJ1ZmZlcjtcbiAgICAgICAgdGhpcy51dk1hdHJpeCA9IHV2TWF0cml4O1xuICAgICAgICB0aGlzLmRhdGEgPSBudWxsO1xuICAgICAgICB0aGlzLl9idWZmZXJVcGRhdGVJZCA9IC0xO1xuICAgICAgICB0aGlzLl90ZXh0dXJlVXBkYXRlSWQgPSAtMTtcbiAgICAgICAgdGhpcy5fdXBkYXRlSUQgPSAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzXG4gICAgICogQHBhcmFtIGZvcmNlVXBkYXRlIC0gZm9yY2UgdGhlIHVwZGF0ZVxuICAgICAqL1xuICAgIE1lc2hCYXRjaFV2cy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGZvcmNlVXBkYXRlKSB7XG4gICAgICAgIGlmICghZm9yY2VVcGRhdGVcbiAgICAgICAgICAgICYmIHRoaXMuX2J1ZmZlclVwZGF0ZUlkID09PSB0aGlzLnV2QnVmZmVyLl91cGRhdGVJRFxuICAgICAgICAgICAgJiYgdGhpcy5fdGV4dHVyZVVwZGF0ZUlkID09PSB0aGlzLnV2TWF0cml4Ll91cGRhdGVJRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2J1ZmZlclVwZGF0ZUlkID0gdGhpcy51dkJ1ZmZlci5fdXBkYXRlSUQ7XG4gICAgICAgIHRoaXMuX3RleHR1cmVVcGRhdGVJZCA9IHRoaXMudXZNYXRyaXguX3VwZGF0ZUlEO1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMudXZCdWZmZXIuZGF0YTtcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEgfHwgdGhpcy5kYXRhLmxlbmd0aCAhPT0gZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoZGF0YS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXZNYXRyaXgubXVsdGlwbHlVdnMoZGF0YSwgdGhpcy5kYXRhKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlSUQrKztcbiAgICB9O1xuICAgIHJldHVybiBNZXNoQmF0Y2hVdnM7XG59KCkpO1xuXG52YXIgdGVtcFBvaW50ID0gbmV3IG1hdGguUG9pbnQoKTtcbnZhciB0ZW1wUG9seWdvbiA9IG5ldyBtYXRoLlBvbHlnb24oKTtcbi8qKlxuICogQmFzZSBtZXNoIGNsYXNzLlxuICpcbiAqIFRoaXMgY2xhc3MgZW1wb3dlcnMgeW91IHRvIGhhdmUgbWF4aW11bSBmbGV4aWJpbGl0eSB0byByZW5kZXIgYW55IGtpbmQgb2YgV2ViR0wgdmlzdWFscyB5b3UgY2FuIHRoaW5rIG9mLlxuICogVGhpcyBjbGFzcyBhc3N1bWVzIGEgY2VydGFpbiBsZXZlbCBvZiBXZWJHTCBrbm93bGVkZ2UuXG4gKiBJZiB5b3Uga25vdyBhIGJpdCB0aGlzIHNob3VsZCBhYnN0cmFjdCBlbm91Z2ggYXdheSB0byBtYWtlIHlvdXIgbGlmZSBlYXNpZXIhXG4gKlxuICogUHJldHR5IG11Y2ggQUxMIFdlYkdMIGNhbiBiZSBicm9rZW4gZG93biBpbnRvIHRoZSBmb2xsb3dpbmc6XG4gKiAtIEdlb21ldHJ5IC0gVGhlIHN0cnVjdHVyZSBhbmQgZGF0YSBmb3IgdGhlIG1lc2guIFRoaXMgY2FuIGluY2x1ZGUgYW55dGhpbmcgZnJvbSBwb3NpdGlvbnMsIHV2cywgbm9ybWFscywgY29sb3JzIGV0Yy4uXG4gKiAtIFNoYWRlciAtIFRoaXMgaXMgdGhlIHNoYWRlciB0aGF0IFBpeGlKUyB3aWxsIHJlbmRlciB0aGUgZ2VvbWV0cnkgd2l0aCAoYXR0cmlidXRlcyBpbiB0aGUgc2hhZGVyIG11c3QgbWF0Y2ggdGhlIGdlb21ldHJ5KVxuICogLSBTdGF0ZSAtIFRoaXMgaXMgdGhlIHN0YXRlIG9mIFdlYkdMIHJlcXVpcmVkIHRvIHJlbmRlciB0aGUgbWVzaC5cbiAqXG4gKiBUaHJvdWdoIGEgY29tYmluYXRpb24gb2YgdGhlIGFib3ZlIGVsZW1lbnRzIHlvdSBjYW4gcmVuZGVyIGFueXRoaW5nIHlvdSB3YW50LCAyRCBvciAzRCFcbiAqIEBtZW1iZXJvZiBQSVhJXG4gKi9cbnZhciBNZXNoID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNZXNoLCBfc3VwZXIpO1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBnZW9tZXRyeSAtIFRoZSBnZW9tZXRyeSB0aGUgbWVzaCB3aWxsIHVzZS5cbiAgICAgKiBAcGFyYW0ge1BJWEkuTWVzaE1hdGVyaWFsfSBzaGFkZXIgLSBUaGUgc2hhZGVyIHRoZSBtZXNoIHdpbGwgdXNlLlxuICAgICAqIEBwYXJhbSBzdGF0ZSAtIFRoZSBzdGF0ZSB0aGF0IHRoZSBXZWJHTCBjb250ZXh0IGlzIHJlcXVpcmVkIHRvIGJlIGluIHRvIHJlbmRlciB0aGUgbWVzaFxuICAgICAqICAgICAgICBpZiBubyBzdGF0ZSBpcyBwcm92aWRlZCwgdXNlcyB7QGxpbmsgUElYSS5TdGF0ZS5mb3IyZH0gdG8gY3JlYXRlIGEgMkQgc3RhdGUgZm9yIFBpeGlKUy5cbiAgICAgKiBAcGFyYW0gZHJhd01vZGUgLSBUaGUgZHJhd01vZGUsIGNhbiBiZSBhbnkgb2YgdGhlIHtAbGluayBQSVhJLkRSQVdfTU9ERVN9IGNvbnN0YW50cy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBNZXNoKGdlb21ldHJ5LCBzaGFkZXIsIHN0YXRlLCBkcmF3TW9kZSkge1xuICAgICAgICBpZiAoZHJhd01vZGUgPT09IHZvaWQgMCkgeyBkcmF3TW9kZSA9IGNvbnN0YW50cy5EUkFXX01PREVTLlRSSUFOR0xFUzsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5O1xuICAgICAgICBfdGhpcy5zaGFkZXIgPSBzaGFkZXI7XG4gICAgICAgIF90aGlzLnN0YXRlID0gc3RhdGUgfHwgY29yZS5TdGF0ZS5mb3IyZCgpO1xuICAgICAgICBfdGhpcy5kcmF3TW9kZSA9IGRyYXdNb2RlO1xuICAgICAgICBfdGhpcy5zdGFydCA9IDA7XG4gICAgICAgIF90aGlzLnNpemUgPSAwO1xuICAgICAgICBfdGhpcy51dnMgPSBudWxsO1xuICAgICAgICBfdGhpcy5pbmRpY2VzID0gbnVsbDtcbiAgICAgICAgX3RoaXMudmVydGV4RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgICAgIF90aGlzLnZlcnRleERpcnR5ID0gLTE7XG4gICAgICAgIF90aGlzLl90cmFuc2Zvcm1JRCA9IC0xO1xuICAgICAgICBfdGhpcy5fcm91bmRQaXhlbHMgPSBzZXR0aW5ncy5zZXR0aW5ncy5ST1VORF9QSVhFTFM7XG4gICAgICAgIF90aGlzLmJhdGNoVXZzID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwiZ2VvbWV0cnlcIiwge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5jbHVkZXMgdmVydGV4IHBvc2l0aW9ucywgZmFjZSBpbmRpY2VzLCBub3JtYWxzLCBjb2xvcnMsIFVWcywgYW5kXG4gICAgICAgICAqIGN1c3RvbSBhdHRyaWJ1dGVzIHdpdGhpbiBidWZmZXJzLCByZWR1Y2luZyB0aGUgY29zdCBvZiBwYXNzaW5nIGFsbFxuICAgICAgICAgKiB0aGlzIGRhdGEgdG8gdGhlIEdQVS4gQ2FuIGJlIHNoYXJlZCBiZXR3ZWVuIG11bHRpcGxlIE1lc2ggb2JqZWN0cy5cbiAgICAgICAgICovXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dlb21ldHJ5O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2dlb21ldHJ5ID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9nZW9tZXRyeSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2dlb21ldHJ5LnJlZkNvdW50LS07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2dlb21ldHJ5LnJlZkNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dlb21ldHJ5LmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9nZW9tZXRyeSA9IHZhbHVlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2dlb21ldHJ5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZ2VvbWV0cnkucmVmQ291bnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudmVydGV4RGlydHkgPSAtMTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoLnByb3RvdHlwZSwgXCJ1dkJ1ZmZlclwiLCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUbyBjaGFuZ2UgbWVzaCB1didzLCBjaGFuZ2UgaXRzIHV2QnVmZmVyIGRhdGEgYW5kIGluY3JlbWVudCBpdHMgX3VwZGF0ZUlELlxuICAgICAgICAgKiBAcmVhZG9ubHlcbiAgICAgICAgICovXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VvbWV0cnkuYnVmZmVyc1sxXTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoLnByb3RvdHlwZSwgXCJ2ZXJ0aWNlc0J1ZmZlclwiLCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUbyBjaGFuZ2UgbWVzaCB2ZXJ0aWNlcywgY2hhbmdlIGl0cyB1dkJ1ZmZlciBkYXRhIGFuZCBpbmNyZW1lbnQgaXRzIF91cGRhdGVJRC5cbiAgICAgICAgICogSW5jcmVtZW50aW5nIF91cGRhdGVJRCBpcyBvcHRpb25hbCBiZWNhdXNlIG1vc3Qgb2YgTWVzaCBvYmplY3RzIGRvIGl0IGFueXdheS5cbiAgICAgICAgICogQHJlYWRvbmx5XG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdlb21ldHJ5LmJ1ZmZlcnNbMF07XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaC5wcm90b3R5cGUsIFwibWF0ZXJpYWxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNoYWRlcjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIEFsaWFzIGZvciB7QGxpbmsgUElYSS5NZXNoI3NoYWRlcn0uICovXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnNoYWRlciA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2gucHJvdG90eXBlLCBcImJsZW5kTW9kZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuYmxlbmRNb2RlO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGJsZW5kIG1vZGUgdG8gYmUgYXBwbGllZCB0byB0aGUgTWVzaC4gQXBwbHkgYSB2YWx1ZSBvZlxuICAgICAgICAgKiBgUElYSS5CTEVORF9NT0RFUy5OT1JNQUxgIHRvIHJlc2V0IHRoZSBibGVuZCBtb2RlLlxuICAgICAgICAgKiBAZGVmYXVsdCBQSVhJLkJMRU5EX01PREVTLk5PUk1BTDtcbiAgICAgICAgICovXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmJsZW5kTW9kZSA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2gucHJvdG90eXBlLCBcInJvdW5kUGl4ZWxzXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcm91bmRQaXhlbHM7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiB0cnVlIFBpeGlKUyB3aWxsIE1hdGguZmxvb3IoKSB4L3kgdmFsdWVzIHdoZW4gcmVuZGVyaW5nLCBzdG9wcGluZyBwaXhlbCBpbnRlcnBvbGF0aW9uLlxuICAgICAgICAgKiBBZHZhbnRhZ2VzIGNhbiBpbmNsdWRlIHNoYXJwZXIgaW1hZ2UgcXVhbGl0eSAobGlrZSB0ZXh0KSBhbmQgZmFzdGVyIHJlbmRlcmluZyBvbiBjYW52YXMuXG4gICAgICAgICAqIFRoZSBtYWluIGRpc2FkdmFudGFnZSBpcyBtb3ZlbWVudCBvZiBvYmplY3RzIG1heSBhcHBlYXIgbGVzcyBzbW9vdGguXG4gICAgICAgICAqIFRvIHNldCB0aGUgZ2xvYmFsIGRlZmF1bHQsIGNoYW5nZSB7QGxpbmsgUElYSS5zZXR0aW5ncy5ST1VORF9QSVhFTFN9XG4gICAgICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JvdW5kUGl4ZWxzICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybUlEID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9yb3VuZFBpeGVscyA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2gucHJvdG90eXBlLCBcInRpbnRcIiwge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG11bHRpcGx5IHRpbnQgYXBwbGllZCB0byB0aGUgTWVzaC4gVGhpcyBpcyBhIGhleCB2YWx1ZS4gQSB2YWx1ZSBvZlxuICAgICAgICAgKiBgMHhGRkZGRkZgIHdpbGwgcmVtb3ZlIGFueSB0aW50IGVmZmVjdC5cbiAgICAgICAgICpcbiAgICAgICAgICogTnVsbCBmb3Igbm9uLU1lc2hNYXRlcmlhbCBzaGFkZXJzXG4gICAgICAgICAqIEBkZWZhdWx0IDB4RkZGRkZGXG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAndGludCcgaW4gdGhpcy5zaGFkZXIgPyB0aGlzLnNoYWRlci50aW50IDogbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2hhZGVyLnRpbnQgPSB2YWx1ZTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoLnByb3RvdHlwZSwgXCJ0ZXh0dXJlXCIsIHtcbiAgICAgICAgLyoqIFRoZSB0ZXh0dXJlIHRoYXQgdGhlIE1lc2ggdXNlcy4gTnVsbCBmb3Igbm9uLU1lc2hNYXRlcmlhbCBzaGFkZXJzICovXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICd0ZXh0dXJlJyBpbiB0aGlzLnNoYWRlciA/IHRoaXMuc2hhZGVyLnRleHR1cmUgOiBudWxsO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zaGFkZXIudGV4dHVyZSA9IHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogU3RhbmRhcmQgcmVuZGVyZXIgZHJhdy5cbiAgICAgKiBAcGFyYW0gcmVuZGVyZXIgLSBJbnN0YW5jZSB0byByZW5kZXJlci5cbiAgICAgKi9cbiAgICBNZXNoLnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgIC8vIHNldCBwcm9wZXJ0aWVzIGZvciBiYXRjaGluZy4uXG4gICAgICAgIC8vIFRPRE8gY291bGQgdXNlIGEgZGlmZmVyZW50IHdheSB0byBncmFiIHZlcnRzP1xuICAgICAgICB2YXIgdmVydGljZXMgPSB0aGlzLmdlb21ldHJ5LmJ1ZmZlcnNbMF0uZGF0YTtcbiAgICAgICAgdmFyIHNoYWRlciA9IHRoaXMuc2hhZGVyO1xuICAgICAgICAvLyBUT0RPIGJlbmNobWFyayBjaGVjayBmb3IgYXR0cmlidXRlIHNpemUuLlxuICAgICAgICBpZiAoc2hhZGVyLmJhdGNoYWJsZVxuICAgICAgICAgICAgJiYgdGhpcy5kcmF3TW9kZSA9PT0gY29uc3RhbnRzLkRSQVdfTU9ERVMuVFJJQU5HTEVTXG4gICAgICAgICAgICAmJiB2ZXJ0aWNlcy5sZW5ndGggPCBNZXNoLkJBVENIQUJMRV9TSVpFICogMikge1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyVG9CYXRjaChyZW5kZXJlcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJEZWZhdWx0KHJlbmRlcmVyKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogU3RhbmRhcmQgbm9uLWJhdGNoaW5nIHdheSBvZiByZW5kZXJpbmcuXG4gICAgICogQHBhcmFtIHJlbmRlcmVyIC0gSW5zdGFuY2UgdG8gcmVuZGVyZXIuXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuX3JlbmRlckRlZmF1bHQgPSBmdW5jdGlvbiAocmVuZGVyZXIpIHtcbiAgICAgICAgdmFyIHNoYWRlciA9IHRoaXMuc2hhZGVyO1xuICAgICAgICBzaGFkZXIuYWxwaGEgPSB0aGlzLndvcmxkQWxwaGE7XG4gICAgICAgIGlmIChzaGFkZXIudXBkYXRlKSB7XG4gICAgICAgICAgICBzaGFkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyZXIuYmF0Y2guZmx1c2goKTtcbiAgICAgICAgLy8gYmluZCBhbmQgc3luYyB1bmlmb3Jtcy4uXG4gICAgICAgIHNoYWRlci51bmlmb3Jtcy50cmFuc2xhdGlvbk1hdHJpeCA9IHRoaXMudHJhbnNmb3JtLndvcmxkVHJhbnNmb3JtLnRvQXJyYXkodHJ1ZSk7XG4gICAgICAgIHJlbmRlcmVyLnNoYWRlci5iaW5kKHNoYWRlcik7XG4gICAgICAgIC8vIHNldCBzdGF0ZS4uXG4gICAgICAgIHJlbmRlcmVyLnN0YXRlLnNldCh0aGlzLnN0YXRlKTtcbiAgICAgICAgLy8gYmluZCB0aGUgZ2VvbWV0cnkuLi5cbiAgICAgICAgcmVuZGVyZXIuZ2VvbWV0cnkuYmluZCh0aGlzLmdlb21ldHJ5LCBzaGFkZXIpO1xuICAgICAgICAvLyB0aGVuIHJlbmRlciBpdFxuICAgICAgICByZW5kZXJlci5nZW9tZXRyeS5kcmF3KHRoaXMuZHJhd01vZGUsIHRoaXMuc2l6ZSwgdGhpcy5zdGFydCwgdGhpcy5nZW9tZXRyeS5pbnN0YW5jZUNvdW50KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJlbmRlcmluZyBieSB1c2luZyB0aGUgQmF0Y2ggc3lzdGVtLlxuICAgICAqIEBwYXJhbSByZW5kZXJlciAtIEluc3RhbmNlIHRvIHJlbmRlcmVyLlxuICAgICAqL1xuICAgIE1lc2gucHJvdG90eXBlLl9yZW5kZXJUb0JhdGNoID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XG4gICAgICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7XG4gICAgICAgIHZhciBzaGFkZXIgPSB0aGlzLnNoYWRlcjtcbiAgICAgICAgaWYgKHNoYWRlci51dk1hdHJpeCkge1xuICAgICAgICAgICAgc2hhZGVyLnV2TWF0cml4LnVwZGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVVdnMoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBzZXQgcHJvcGVydGllcyBmb3IgYmF0Y2hpbmcuLlxuICAgICAgICB0aGlzLmNhbGN1bGF0ZVZlcnRpY2VzKCk7XG4gICAgICAgIHRoaXMuaW5kaWNlcyA9IGdlb21ldHJ5LmluZGV4QnVmZmVyLmRhdGE7XG4gICAgICAgIHRoaXMuX3RpbnRSR0IgPSBzaGFkZXIuX3RpbnRSR0I7XG4gICAgICAgIHRoaXMuX3RleHR1cmUgPSBzaGFkZXIudGV4dHVyZTtcbiAgICAgICAgdmFyIHBsdWdpbk5hbWUgPSB0aGlzLm1hdGVyaWFsLnBsdWdpbk5hbWU7XG4gICAgICAgIHJlbmRlcmVyLmJhdGNoLnNldE9iamVjdFJlbmRlcmVyKHJlbmRlcmVyLnBsdWdpbnNbcGx1Z2luTmFtZV0pO1xuICAgICAgICByZW5kZXJlci5wbHVnaW5zW3BsdWdpbk5hbWVdLnJlbmRlcih0aGlzKTtcbiAgICB9O1xuICAgIC8qKiBVcGRhdGVzIHZlcnRleERhdGEgZmllbGQgYmFzZWQgb24gdHJhbnNmb3JtIGFuZCB2ZXJ0aWNlcy4gKi9cbiAgICBNZXNoLnByb3RvdHlwZS5jYWxjdWxhdGVWZXJ0aWNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTtcbiAgICAgICAgdmFyIHZlcnRpY2VzQnVmZmVyID0gZ2VvbWV0cnkuYnVmZmVyc1swXTtcbiAgICAgICAgdmFyIHZlcnRpY2VzID0gdmVydGljZXNCdWZmZXIuZGF0YTtcbiAgICAgICAgdmFyIHZlcnRleERpcnR5SWQgPSB2ZXJ0aWNlc0J1ZmZlci5fdXBkYXRlSUQ7XG4gICAgICAgIGlmICh2ZXJ0ZXhEaXJ0eUlkID09PSB0aGlzLnZlcnRleERpcnR5ICYmIHRoaXMuX3RyYW5zZm9ybUlEID09PSB0aGlzLnRyYW5zZm9ybS5fd29ybGRJRCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3RyYW5zZm9ybUlEID0gdGhpcy50cmFuc2Zvcm0uX3dvcmxkSUQ7XG4gICAgICAgIGlmICh0aGlzLnZlcnRleERhdGEubGVuZ3RoICE9PSB2ZXJ0aWNlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMudmVydGV4RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgd3QgPSB0aGlzLnRyYW5zZm9ybS53b3JsZFRyYW5zZm9ybTtcbiAgICAgICAgdmFyIGEgPSB3dC5hO1xuICAgICAgICB2YXIgYiA9IHd0LmI7XG4gICAgICAgIHZhciBjID0gd3QuYztcbiAgICAgICAgdmFyIGQgPSB3dC5kO1xuICAgICAgICB2YXIgdHggPSB3dC50eDtcbiAgICAgICAgdmFyIHR5ID0gd3QudHk7XG4gICAgICAgIHZhciB2ZXJ0ZXhEYXRhID0gdGhpcy52ZXJ0ZXhEYXRhO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZlcnRleERhdGEubGVuZ3RoIC8gMjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgeCA9IHZlcnRpY2VzWyhpICogMildO1xuICAgICAgICAgICAgdmFyIHkgPSB2ZXJ0aWNlc1soaSAqIDIpICsgMV07XG4gICAgICAgICAgICB2ZXJ0ZXhEYXRhWyhpICogMildID0gKGEgKiB4KSArIChjICogeSkgKyB0eDtcbiAgICAgICAgICAgIHZlcnRleERhdGFbKGkgKiAyKSArIDFdID0gKGIgKiB4KSArIChkICogeSkgKyB0eTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcm91bmRQaXhlbHMpIHtcbiAgICAgICAgICAgIHZhciByZXNvbHV0aW9uID0gc2V0dGluZ3Muc2V0dGluZ3MuUkVTT0xVVElPTjtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVydGV4RGF0YS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHZlcnRleERhdGFbaV0gPSBNYXRoLnJvdW5kKCh2ZXJ0ZXhEYXRhW2ldICogcmVzb2x1dGlvbiB8IDApIC8gcmVzb2x1dGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52ZXJ0ZXhEaXJ0eSA9IHZlcnRleERpcnR5SWQ7XG4gICAgfTtcbiAgICAvKiogVXBkYXRlcyB1diBmaWVsZCBiYXNlZCBvbiBmcm9tIGdlb21ldHJ5IHV2J3Mgb3IgYmF0Y2hVdnMuICovXG4gICAgTWVzaC5wcm90b3R5cGUuY2FsY3VsYXRlVXZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZ2VvbVV2cyA9IHRoaXMuZ2VvbWV0cnkuYnVmZmVyc1sxXTtcbiAgICAgICAgdmFyIHNoYWRlciA9IHRoaXMuc2hhZGVyO1xuICAgICAgICBpZiAoIXNoYWRlci51dk1hdHJpeC5pc1NpbXBsZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmJhdGNoVXZzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iYXRjaFV2cyA9IG5ldyBNZXNoQmF0Y2hVdnMoZ2VvbVV2cywgc2hhZGVyLnV2TWF0cml4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYmF0Y2hVdnMudXBkYXRlKCk7XG4gICAgICAgICAgICB0aGlzLnV2cyA9IHRoaXMuYmF0Y2hVdnMuZGF0YTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudXZzID0gZ2VvbVV2cy5kYXRhO1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBib3VuZHMgb2YgdGhlIG1lc2ggYXMgYSByZWN0YW5nbGUuIFRoZSBib3VuZHMgY2FsY3VsYXRpb24gdGFrZXMgdGhlIHdvcmxkVHJhbnNmb3JtIGludG8gYWNjb3VudC5cbiAgICAgKiB0aGVyZSBtdXN0IGJlIGEgYVZlcnRleFBvc2l0aW9uIGF0dHJpYnV0ZSBwcmVzZW50IGluIHRoZSBnZW9tZXRyeSBmb3IgYm91bmRzIHRvIGJlIGNhbGN1bGF0ZWQgY29ycmVjdGx5LlxuICAgICAqL1xuICAgIE1lc2gucHJvdG90eXBlLl9jYWxjdWxhdGVCb3VuZHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRlVmVydGljZXMoKTtcbiAgICAgICAgdGhpcy5fYm91bmRzLmFkZFZlcnRleERhdGEodGhpcy52ZXJ0ZXhEYXRhLCAwLCB0aGlzLnZlcnRleERhdGEubGVuZ3RoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFRlc3RzIGlmIGEgcG9pbnQgaXMgaW5zaWRlIHRoaXMgbWVzaC4gV29ya3Mgb25seSBmb3IgUElYSS5EUkFXX01PREVTLlRSSUFOR0xFUy5cbiAgICAgKiBAcGFyYW0gcG9pbnQgLSBUaGUgcG9pbnQgdG8gdGVzdC5cbiAgICAgKiBAcmV0dXJucyAtIFRoZSByZXN1bHQgb2YgdGhlIHRlc3QuXG4gICAgICovXG4gICAgTWVzaC5wcm90b3R5cGUuY29udGFpbnNQb2ludCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICBpZiAoIXRoaXMuZ2V0Qm91bmRzKCkuY29udGFpbnMocG9pbnQueCwgcG9pbnQueSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndvcmxkVHJhbnNmb3JtLmFwcGx5SW52ZXJzZShwb2ludCwgdGVtcFBvaW50KTtcbiAgICAgICAgdmFyIHZlcnRpY2VzID0gdGhpcy5nZW9tZXRyeS5nZXRCdWZmZXIoJ2FWZXJ0ZXhQb3NpdGlvbicpLmRhdGE7XG4gICAgICAgIHZhciBwb2ludHMgPSB0ZW1wUG9seWdvbi5wb2ludHM7XG4gICAgICAgIHZhciBpbmRpY2VzID0gdGhpcy5nZW9tZXRyeS5nZXRJbmRleCgpLmRhdGE7XG4gICAgICAgIHZhciBsZW4gPSBpbmRpY2VzLmxlbmd0aDtcbiAgICAgICAgdmFyIHN0ZXAgPSB0aGlzLmRyYXdNb2RlID09PSA0ID8gMyA6IDE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpICsgMiA8IGxlbjsgaSArPSBzdGVwKSB7XG4gICAgICAgICAgICB2YXIgaW5kMCA9IGluZGljZXNbaV0gKiAyO1xuICAgICAgICAgICAgdmFyIGluZDEgPSBpbmRpY2VzW2kgKyAxXSAqIDI7XG4gICAgICAgICAgICB2YXIgaW5kMiA9IGluZGljZXNbaSArIDJdICogMjtcbiAgICAgICAgICAgIHBvaW50c1swXSA9IHZlcnRpY2VzW2luZDBdO1xuICAgICAgICAgICAgcG9pbnRzWzFdID0gdmVydGljZXNbaW5kMCArIDFdO1xuICAgICAgICAgICAgcG9pbnRzWzJdID0gdmVydGljZXNbaW5kMV07XG4gICAgICAgICAgICBwb2ludHNbM10gPSB2ZXJ0aWNlc1tpbmQxICsgMV07XG4gICAgICAgICAgICBwb2ludHNbNF0gPSB2ZXJ0aWNlc1tpbmQyXTtcbiAgICAgICAgICAgIHBvaW50c1s1XSA9IHZlcnRpY2VzW2luZDIgKyAxXTtcbiAgICAgICAgICAgIGlmICh0ZW1wUG9seWdvbi5jb250YWlucyh0ZW1wUG9pbnQueCwgdGVtcFBvaW50LnkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgTWVzaC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICBpZiAodGhpcy5fY2FjaGVkVGV4dHVyZSkge1xuICAgICAgICAgICAgdGhpcy5fY2FjaGVkVGV4dHVyZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB0aGlzLl9jYWNoZWRUZXh0dXJlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdlb21ldHJ5ID0gbnVsbDtcbiAgICAgICAgdGhpcy5zaGFkZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnN0YXRlID0gbnVsbDtcbiAgICAgICAgdGhpcy51dnMgPSBudWxsO1xuICAgICAgICB0aGlzLmluZGljZXMgPSBudWxsO1xuICAgICAgICB0aGlzLnZlcnRleERhdGEgPSBudWxsO1xuICAgIH07XG4gICAgLyoqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB2ZXJ0aWNlcyB0byBjb25zaWRlciBiYXRjaGFibGUuIEdlbmVyYWxseSwgdGhlIGNvbXBsZXhpdHkgb2YgdGhlIGdlb21ldHJ5LiAqL1xuICAgIE1lc2guQkFUQ0hBQkxFX1NJWkUgPSAxMDA7XG4gICAgcmV0dXJuIE1lc2g7XG59KGRpc3BsYXkuQ29udGFpbmVyKSk7XG5cbnZhciBmcmFnbWVudCA9IFwidmFyeWluZyB2ZWMyIHZUZXh0dXJlQ29vcmQ7XFxudW5pZm9ybSB2ZWM0IHVDb2xvcjtcXG5cXG51bmlmb3JtIHNhbXBsZXIyRCB1U2FtcGxlcjtcXG5cXG52b2lkIG1haW4odm9pZClcXG57XFxuICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCh1U2FtcGxlciwgdlRleHR1cmVDb29yZCkgKiB1Q29sb3I7XFxufVxcblwiO1xuXG52YXIgdmVydGV4ID0gXCJhdHRyaWJ1dGUgdmVjMiBhVmVydGV4UG9zaXRpb247XFxuYXR0cmlidXRlIHZlYzIgYVRleHR1cmVDb29yZDtcXG5cXG51bmlmb3JtIG1hdDMgcHJvamVjdGlvbk1hdHJpeDtcXG51bmlmb3JtIG1hdDMgdHJhbnNsYXRpb25NYXRyaXg7XFxudW5pZm9ybSBtYXQzIHVUZXh0dXJlTWF0cml4O1xcblxcbnZhcnlpbmcgdmVjMiB2VGV4dHVyZUNvb3JkO1xcblxcbnZvaWQgbWFpbih2b2lkKVxcbntcXG4gICAgZ2xfUG9zaXRpb24gPSB2ZWM0KChwcm9qZWN0aW9uTWF0cml4ICogdHJhbnNsYXRpb25NYXRyaXggKiB2ZWMzKGFWZXJ0ZXhQb3NpdGlvbiwgMS4wKSkueHksIDAuMCwgMS4wKTtcXG5cXG4gICAgdlRleHR1cmVDb29yZCA9ICh1VGV4dHVyZU1hdHJpeCAqIHZlYzMoYVRleHR1cmVDb29yZCwgMS4wKSkueHk7XFxufVxcblwiO1xuXG4vKipcbiAqIFNsaWdodGx5IG9waW5pb25hdGVkIGRlZmF1bHQgc2hhZGVyIGZvciBQaXhpSlMgMkQgb2JqZWN0cy5cbiAqIEBtZW1iZXJvZiBQSVhJXG4gKi9cbnZhciBNZXNoTWF0ZXJpYWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1lc2hNYXRlcmlhbCwgX3N1cGVyKTtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdVNhbXBsZXIgLSBUZXh0dXJlIHRoYXQgbWF0ZXJpYWwgdXNlcyB0byByZW5kZXIuXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBBZGRpdGlvbmFsIG9wdGlvbnNcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuYWxwaGE9MV0gLSBEZWZhdWx0IGFscGhhLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy50aW50PTB4RkZGRkZGXSAtIERlZmF1bHQgdGludC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMucGx1Z2luTmFtZT0nYmF0Y2gnXSAtIFJlbmRlcmVyIHBsdWdpbiBmb3IgYmF0Y2hpbmcuXG4gICAgICogQHBhcmFtIHtQSVhJLlByb2dyYW19IFtvcHRpb25zLnByb2dyYW09MHhGRkZGRkZdIC0gQ3VzdG9tIHByb2dyYW0uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zLnVuaWZvcm1zXSAtIEN1c3RvbSB1bmlmb3Jtcy5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBNZXNoTWF0ZXJpYWwodVNhbXBsZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHVuaWZvcm1zID0ge1xuICAgICAgICAgICAgdVNhbXBsZXI6IHVTYW1wbGVyLFxuICAgICAgICAgICAgYWxwaGE6IDEsXG4gICAgICAgICAgICB1VGV4dHVyZU1hdHJpeDogbWF0aC5NYXRyaXguSURFTlRJVFksXG4gICAgICAgICAgICB1Q29sb3I6IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDEsIDFdKSxcbiAgICAgICAgfTtcbiAgICAgICAgLy8gU2V0IGRlZmF1bHRzXG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgIHRpbnQ6IDB4RkZGRkZGLFxuICAgICAgICAgICAgYWxwaGE6IDEsXG4gICAgICAgICAgICBwbHVnaW5OYW1lOiAnYmF0Y2gnLFxuICAgICAgICB9LCBvcHRpb25zKTtcbiAgICAgICAgaWYgKG9wdGlvbnMudW5pZm9ybXMpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odW5pZm9ybXMsIG9wdGlvbnMudW5pZm9ybXMpO1xuICAgICAgICB9XG4gICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgb3B0aW9ucy5wcm9ncmFtIHx8IGNvcmUuUHJvZ3JhbS5mcm9tKHZlcnRleCwgZnJhZ21lbnQpLCB1bmlmb3JtcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2NvbG9yRGlydHkgPSBmYWxzZTtcbiAgICAgICAgX3RoaXMudXZNYXRyaXggPSBuZXcgY29yZS5UZXh0dXJlTWF0cml4KHVTYW1wbGVyKTtcbiAgICAgICAgX3RoaXMuYmF0Y2hhYmxlID0gb3B0aW9ucy5wcm9ncmFtID09PSB1bmRlZmluZWQ7XG4gICAgICAgIF90aGlzLnBsdWdpbk5hbWUgPSBvcHRpb25zLnBsdWdpbk5hbWU7XG4gICAgICAgIF90aGlzLnRpbnQgPSBvcHRpb25zLnRpbnQ7XG4gICAgICAgIF90aGlzLmFscGhhID0gb3B0aW9ucy5hbHBoYTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWVzaE1hdGVyaWFsLnByb3RvdHlwZSwgXCJ0ZXh0dXJlXCIsIHtcbiAgICAgICAgLyoqIFJlZmVyZW5jZSB0byB0aGUgdGV4dHVyZSBiZWluZyByZW5kZXJlZC4gKi9cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy51bmlmb3Jtcy51U2FtcGxlcjtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnVuaWZvcm1zLnVTYW1wbGVyICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy51bmlmb3Jtcy51U2FtcGxlci5iYXNlVGV4dHVyZS5hbHBoYU1vZGUgIT09ICF2YWx1ZS5iYXNlVGV4dHVyZS5hbHBoYU1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29sb3JEaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudW5pZm9ybXMudVNhbXBsZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnV2TWF0cml4LnRleHR1cmUgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZXNoTWF0ZXJpYWwucHJvdG90eXBlLCBcImFscGhhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxwaGE7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIGdldHMgYXV0b21hdGljYWxseSBzZXQgYnkgdGhlIG9iamVjdCB1c2luZyB0aGlzLlxuICAgICAgICAgKiBAZGVmYXVsdCAxXG4gICAgICAgICAqL1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0aGlzLl9hbHBoYSlcbiAgICAgICAgICAgICAgICB7IHJldHVybjsgfVxuICAgICAgICAgICAgdGhpcy5fYWxwaGEgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuX2NvbG9yRGlydHkgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2hNYXRlcmlhbC5wcm90b3R5cGUsIFwidGludFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNdWx0aXBseSB0aW50IGZvciB0aGUgbWF0ZXJpYWwuXG4gICAgICAgICAqIEBkZWZhdWx0IDB4RkZGRkZGXG4gICAgICAgICAqL1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0aGlzLl90aW50KVxuICAgICAgICAgICAgICAgIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICB0aGlzLl90aW50ID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLl90aW50UkdCID0gKHZhbHVlID4+IDE2KSArICh2YWx1ZSAmIDB4ZmYwMCkgKyAoKHZhbHVlICYgMHhmZikgPDwgMTYpO1xuICAgICAgICAgICAgdGhpcy5fY29sb3JEaXJ0eSA9IHRydWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICAvKiogR2V0cyBjYWxsZWQgYXV0b21hdGljYWxseSBieSB0aGUgTWVzaC4gSW50ZW5kZWQgdG8gYmUgb3ZlcnJpZGRlbiBmb3IgY3VzdG9tIHtAbGluayBNZXNoTWF0ZXJpYWx9IG9iamVjdHMuICovXG4gICAgTWVzaE1hdGVyaWFsLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb2xvckRpcnR5KSB7XG4gICAgICAgICAgICB0aGlzLl9jb2xvckRpcnR5ID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgYmFzZVRleHR1cmUgPSB0aGlzLnRleHR1cmUuYmFzZVRleHR1cmU7XG4gICAgICAgICAgICB1dGlscy5wcmVtdWx0aXBseVRpbnRUb1JnYmEodGhpcy5fdGludCwgdGhpcy5fYWxwaGEsIHRoaXMudW5pZm9ybXMudUNvbG9yLCBiYXNlVGV4dHVyZS5hbHBoYU1vZGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnV2TWF0cml4LnVwZGF0ZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnVuaWZvcm1zLnVUZXh0dXJlTWF0cml4ID0gdGhpcy51dk1hdHJpeC5tYXBDb29yZDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIE1lc2hNYXRlcmlhbDtcbn0oY29yZS5TaGFkZXIpKTtcblxuLyoqXG4gKiBTdGFuZGFyZCAyRCBnZW9tZXRyeSB1c2VkIGluIFBpeGlKUy5cbiAqXG4gKiBHZW9tZXRyeSBjYW4gYmUgZGVmaW5lZCB3aXRob3V0IHBhc3NpbmcgaW4gYSBzdHlsZSBvciBkYXRhIGlmIHJlcXVpcmVkLlxuICpcbiAqIGBgYGpzXG4gKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBQSVhJLkdlb21ldHJ5KCk7XG4gKlxuICogZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCdwb3NpdGlvbnMnLCBbMCwgMCwgMTAwLCAwLCAxMDAsIDEwMCwgMCwgMTAwXSwgMik7XG4gKiBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoJ3V2cycsIFswLDAsMSwwLDEsMSwwLDFdLCAyKTtcbiAqIGdlb21ldHJ5LmFkZEluZGV4KFswLDEsMiwxLDMsMl0pO1xuICpcbiAqIGBgYFxuICogQG1lbWJlcm9mIFBJWElcbiAqL1xudmFyIE1lc2hHZW9tZXRyeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWVzaEdlb21ldHJ5LCBfc3VwZXIpO1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7RmxvYXQzMkFycmF5fG51bWJlcltdfSBbdmVydGljZXNdIC0gUG9zaXRpb25hbCBkYXRhIG9uIGdlb21ldHJ5LlxuICAgICAqIEBwYXJhbSB7RmxvYXQzMkFycmF5fG51bWJlcltdfSBbdXZzXSAtIFRleHR1cmUgVVZzLlxuICAgICAqIEBwYXJhbSB7VWludDE2QXJyYXl8bnVtYmVyW119IFtpbmRleF0gLSBJbmRleEJ1ZmZlclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE1lc2hHZW9tZXRyeSh2ZXJ0aWNlcywgdXZzLCBpbmRleCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICB2YXIgdmVydGljZXNCdWZmZXIgPSBuZXcgY29yZS5CdWZmZXIodmVydGljZXMpO1xuICAgICAgICB2YXIgdXZzQnVmZmVyID0gbmV3IGNvcmUuQnVmZmVyKHV2cywgdHJ1ZSk7XG4gICAgICAgIHZhciBpbmRleEJ1ZmZlciA9IG5ldyBjb3JlLkJ1ZmZlcihpbmRleCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICAgIF90aGlzLmFkZEF0dHJpYnV0ZSgnYVZlcnRleFBvc2l0aW9uJywgdmVydGljZXNCdWZmZXIsIDIsIGZhbHNlLCBjb25zdGFudHMuVFlQRVMuRkxPQVQpXG4gICAgICAgICAgICAuYWRkQXR0cmlidXRlKCdhVGV4dHVyZUNvb3JkJywgdXZzQnVmZmVyLCAyLCBmYWxzZSwgY29uc3RhbnRzLlRZUEVTLkZMT0FUKVxuICAgICAgICAgICAgLmFkZEluZGV4KGluZGV4QnVmZmVyKTtcbiAgICAgICAgX3RoaXMuX3VwZGF0ZUlkID0gLTE7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lc2hHZW9tZXRyeS5wcm90b3R5cGUsIFwidmVydGV4RGlydHlJZFwiLCB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiB0aGUgdmVydGV4IHBvc2l0aW9uIGlzIHVwZGF0ZWQuXG4gICAgICAgICAqIEByZWFkb25seVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXJzWzBdLl91cGRhdGVJRDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBNZXNoR2VvbWV0cnk7XG59KGNvcmUuR2VvbWV0cnkpKTtcblxuZXhwb3J0cy5NZXNoID0gTWVzaDtcbmV4cG9ydHMuTWVzaEJhdGNoVXZzID0gTWVzaEJhdGNoVXZzO1xuZXhwb3J0cy5NZXNoR2VvbWV0cnkgPSBNZXNoR2VvbWV0cnk7XG5leHBvcnRzLk1lc2hNYXRlcmlhbCA9IE1lc2hNYXRlcmlhbDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1lc2guanMubWFwXG4iXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjb3JlIiwibWF0aCIsImNvbnN0YW50cyIsImRpc3BsYXkiLCJzZXR0aW5ncyIsInV0aWxzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJoYXNPd25Qcm9wZXJ0eSIsIl9fZXh0ZW5kcyIsIl9fIiwidGhpcyIsImNvbnN0cnVjdG9yIiwicHJvdG90eXBlIiwiY3JlYXRlIiwiTWVzaEJhdGNoVXZzIiwidXZCdWZmZXIiLCJ1dk1hdHJpeCIsImRhdGEiLCJfYnVmZmVyVXBkYXRlSWQiLCJfdGV4dHVyZVVwZGF0ZUlkIiwiX3VwZGF0ZUlEIiwidXBkYXRlIiwiZm9yY2VVcGRhdGUiLCJsZW5ndGgiLCJGbG9hdDMyQXJyYXkiLCJtdWx0aXBseVV2cyIsInRlbXBQb2ludCIsIlBvaW50IiwidGVtcFBvbHlnb24iLCJQb2x5Z29uIiwiTWVzaCIsIl9zdXBlciIsImdlb21ldHJ5Iiwic2hhZGVyIiwic3RhdGUiLCJkcmF3TW9kZSIsIkRSQVdfTU9ERVMiLCJUUklBTkdMRVMiLCJfdGhpcyIsImNhbGwiLCJTdGF0ZSIsImZvcjJkIiwic3RhcnQiLCJzaXplIiwidXZzIiwiaW5kaWNlcyIsInZlcnRleERhdGEiLCJ2ZXJ0ZXhEaXJ0eSIsIl90cmFuc2Zvcm1JRCIsIl9yb3VuZFBpeGVscyIsIlJPVU5EX1BJWEVMUyIsImJhdGNoVXZzIiwiZ2V0IiwiX2dlb21ldHJ5Iiwic2V0IiwicmVmQ291bnQiLCJkaXNwb3NlIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsImJ1ZmZlcnMiLCJibGVuZE1vZGUiLCJ0aW50IiwidGV4dHVyZSIsIl9yZW5kZXIiLCJyZW5kZXJlciIsInZlcnRpY2VzIiwiYmF0Y2hhYmxlIiwiQkFUQ0hBQkxFX1NJWkUiLCJfcmVuZGVyVG9CYXRjaCIsIl9yZW5kZXJEZWZhdWx0IiwiYWxwaGEiLCJ3b3JsZEFscGhhIiwiYmF0Y2giLCJmbHVzaCIsInVuaWZvcm1zIiwidHJhbnNsYXRpb25NYXRyaXgiLCJ0cmFuc2Zvcm0iLCJ3b3JsZFRyYW5zZm9ybSIsInRvQXJyYXkiLCJiaW5kIiwiZHJhdyIsImluc3RhbmNlQ291bnQiLCJjYWxjdWxhdGVVdnMiLCJjYWxjdWxhdGVWZXJ0aWNlcyIsImluZGV4QnVmZmVyIiwiX3RpbnRSR0IiLCJfdGV4dHVyZSIsInBsdWdpbk5hbWUiLCJtYXRlcmlhbCIsInNldE9iamVjdFJlbmRlcmVyIiwicGx1Z2lucyIsInJlbmRlciIsInZlcnRpY2VzQnVmZmVyIiwidmVydGV4RGlydHlJZCIsIl93b3JsZElEIiwid3QiLCJhIiwiYyIsInR4IiwidHkiLCJpIiwieCIsInkiLCJyZXNvbHV0aW9uIiwiUkVTT0xVVElPTiIsIk1hdGgiLCJyb3VuZCIsImdlb21VdnMiLCJpc1NpbXBsZSIsIl9jYWxjdWxhdGVCb3VuZHMiLCJfYm91bmRzIiwiYWRkVmVydGV4RGF0YSIsImNvbnRhaW5zUG9pbnQiLCJwb2ludCIsImdldEJvdW5kcyIsImNvbnRhaW5zIiwiYXBwbHlJbnZlcnNlIiwiZ2V0QnVmZmVyIiwicG9pbnRzIiwiZ2V0SW5kZXgiLCJsZW4iLCJzdGVwIiwiaW5kMCIsImluZDEiLCJpbmQyIiwiZGVzdHJveSIsIm9wdGlvbnMiLCJfY2FjaGVkVGV4dHVyZSIsIkNvbnRhaW5lciIsIk1lc2hNYXRlcmlhbCIsInVTYW1wbGVyIiwidVRleHR1cmVNYXRyaXgiLCJNYXRyaXgiLCJJREVOVElUWSIsInVDb2xvciIsImFzc2lnbiIsInByb2dyYW0iLCJQcm9ncmFtIiwiZnJvbSIsIl9jb2xvckRpcnR5IiwiVGV4dHVyZU1hdHJpeCIsInVuZGVmaW5lZCIsImJhc2VUZXh0dXJlIiwiYWxwaGFNb2RlIiwiX2FscGhhIiwiX3RpbnQiLCJwcmVtdWx0aXBseVRpbnRUb1JnYmEiLCJtYXBDb29yZCIsIlNoYWRlciIsIk1lc2hHZW9tZXRyeSIsImluZGV4IiwiQnVmZmVyIiwidXZzQnVmZmVyIiwiYWRkQXR0cmlidXRlIiwiVFlQRVMiLCJGTE9BVCIsImFkZEluZGV4IiwiX3VwZGF0ZUlkIiwiR2VvbWV0cnkiXSwic291cmNlUm9vdCI6IiJ9